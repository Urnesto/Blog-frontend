{"ast":null,"code":"'use strict';\n\nvar CodeMirror = require('codemirror');\n\nrequire('codemirror/addon/edit/continuelist.js');\n\nrequire('./codemirror/tablist');\n\nrequire('codemirror/addon/display/fullscreen.js');\n\nrequire('codemirror/mode/markdown/markdown.js');\n\nrequire('codemirror/addon/mode/overlay.js');\n\nrequire('codemirror/addon/display/placeholder.js');\n\nrequire('codemirror/addon/display/autorefresh.js');\n\nrequire('codemirror/addon/selection/mark-selection.js');\n\nrequire('codemirror/addon/search/searchcursor.js');\n\nrequire('codemirror/mode/gfm/gfm.js');\n\nrequire('codemirror/mode/xml/xml.js');\n\nvar CodeMirrorSpellChecker = require('codemirror-spell-checker');\n\nvar marked = require('marked').marked; // Some variables\n\n\nvar isMac = /Mac/.test(navigator.platform);\nvar anchorToExternalRegex = new RegExp(/(<a.*?https?:\\/\\/.*?[^a]>)+?/g); // Mapping of actions that can be bound to keyboard shortcuts or toolbar buttons\n\nvar bindings = {\n  'toggleBold': toggleBold,\n  'toggleItalic': toggleItalic,\n  'drawLink': drawLink,\n  'toggleHeadingSmaller': toggleHeadingSmaller,\n  'toggleHeadingBigger': toggleHeadingBigger,\n  'drawImage': drawImage,\n  'toggleBlockquote': toggleBlockquote,\n  'toggleOrderedList': toggleOrderedList,\n  'toggleUnorderedList': toggleUnorderedList,\n  'toggleCodeBlock': toggleCodeBlock,\n  'togglePreview': togglePreview,\n  'toggleStrikethrough': toggleStrikethrough,\n  'toggleHeading1': toggleHeading1,\n  'toggleHeading2': toggleHeading2,\n  'toggleHeading3': toggleHeading3,\n  'cleanBlock': cleanBlock,\n  'drawTable': drawTable,\n  'drawHorizontalRule': drawHorizontalRule,\n  'undo': undo,\n  'redo': redo,\n  'toggleSideBySide': toggleSideBySide,\n  'toggleFullScreen': toggleFullScreen\n};\nvar shortcuts = {\n  'toggleBold': 'Cmd-B',\n  'toggleItalic': 'Cmd-I',\n  'drawLink': 'Cmd-K',\n  'toggleHeadingSmaller': 'Cmd-H',\n  'toggleHeadingBigger': 'Shift-Cmd-H',\n  'cleanBlock': 'Cmd-E',\n  'drawImage': 'Cmd-Alt-I',\n  'toggleBlockquote': 'Cmd-\\'',\n  'toggleOrderedList': 'Cmd-Alt-L',\n  'toggleUnorderedList': 'Cmd-L',\n  'toggleCodeBlock': 'Cmd-Alt-C',\n  'togglePreview': 'Cmd-P',\n  'toggleSideBySide': 'F9',\n  'toggleFullScreen': 'F11'\n};\n\nvar getBindingName = function (f) {\n  for (var key in bindings) {\n    if (bindings[key] === f) {\n      return key;\n    }\n  }\n\n  return null;\n};\n\nvar isMobile = function () {\n  var check = false;\n\n  (function (a) {\n    if (/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(a.substr(0, 4))) check = true;\n  })(navigator.userAgent || navigator.vendor || window.opera);\n\n  return check;\n};\n/**\n * Modify HTML to add 'target=\"_blank\"' to links so they open in new tabs by default.\n * @param {string} htmlText - HTML to be modified.\n * @return {string} The modified HTML text.\n */\n\n\nfunction addAnchorTargetBlank(htmlText) {\n  var match;\n\n  while ((match = anchorToExternalRegex.exec(htmlText)) !== null) {\n    // With only one capture group in the RegExp, we can safely take the first index from the match.\n    var linkString = match[0];\n\n    if (linkString.indexOf('target=') === -1) {\n      var fixedLinkString = linkString.replace(/>$/, ' target=\"_blank\">');\n      htmlText = htmlText.replace(linkString, fixedLinkString);\n    }\n  }\n\n  return htmlText;\n}\n/**\n * Modify HTML to remove the list-style when rendering checkboxes.\n * @param {string} htmlText - HTML to be modified.\n * @return {string} The modified HTML text.\n */\n\n\nfunction removeListStyleWhenCheckbox(htmlText) {\n  var parser = new DOMParser();\n  var htmlDoc = parser.parseFromString(htmlText, 'text/html');\n  var listItems = htmlDoc.getElementsByTagName('li');\n\n  for (var i = 0; i < listItems.length; i++) {\n    var listItem = listItems[i];\n\n    for (var j = 0; j < listItem.children.length; j++) {\n      var listItemChild = listItem.children[j];\n\n      if (listItemChild instanceof HTMLInputElement && listItemChild.type === 'checkbox') {\n        // From Github: margin: 0 .2em .25em -1.6em;\n        listItem.style.marginLeft = '-1.5em';\n        listItem.style.listStyleType = 'none';\n      }\n    }\n  }\n\n  return htmlDoc.documentElement.innerHTML;\n}\n/**\n * Fix shortcut. Mac use Command, others use Ctrl.\n */\n\n\nfunction fixShortcut(name) {\n  if (isMac) {\n    name = name.replace('Ctrl', 'Cmd');\n  } else {\n    name = name.replace('Cmd', 'Ctrl');\n  }\n\n  return name;\n}\n/**\n * Class handling utility methods.\n */\n\n\nvar CLASS_REGEX = {};\n/**\n * Convert a className string into a regex for matching (and cache).\n * Note that the RegExp includes trailing spaces for replacement\n * (to ensure that removing a class from the middle of the string will retain\n *  spacing between other classes.)\n * @param {String} className Class name to convert to regex for matching.\n * @returns {RegExp} Regular expression option that will match className.\n */\n\nfunction getClassRegex(className) {\n  return CLASS_REGEX[className] || (CLASS_REGEX[className] = new RegExp('\\\\s*' + className + '(\\\\s*)', 'g'));\n}\n/**\n * Add a class string to an element.\n * @param {Element} el DOM element on which to add className.\n * @param {String} className Class string to apply\n * @returns {void}\n */\n\n\nfunction addClass(el, className) {\n  if (!el || !className) return;\n  var classRegex = getClassRegex(className);\n  if (el.className.match(classRegex)) return; // already applied\n\n  el.className += ' ' + className;\n}\n/**\n * Remove a class string from an element.\n * @param {Element} el DOM element from which to remove className.\n * @param {String} className Class string to remove\n * @returns {void}\n */\n\n\nfunction removeClass(el, className) {\n  if (!el || !className) return;\n  var classRegex = getClassRegex(className);\n  if (!el.className.match(classRegex)) return; // not available to remove\n\n  el.className = el.className.replace(classRegex, '$1');\n}\n/**\n * Create dropdown block\n */\n\n\nfunction createToolbarDropdown(options, enableTooltips, shortcuts, parent) {\n  var el = createToolbarButton(options, false, enableTooltips, shortcuts, 'button', parent);\n  el.className += ' easymde-dropdown';\n\n  el.onclick = function () {\n    el.focus();\n  };\n\n  var content = document.createElement('div');\n  content.className = 'easymde-dropdown-content';\n\n  for (var childrenIndex = 0; childrenIndex < options.children.length; childrenIndex++) {\n    var child = options.children[childrenIndex];\n    var childElement;\n\n    if (typeof child === 'string' && child in toolbarBuiltInButtons) {\n      childElement = createToolbarButton(toolbarBuiltInButtons[child], true, enableTooltips, shortcuts, 'button', parent);\n    } else {\n      childElement = createToolbarButton(child, true, enableTooltips, shortcuts, 'button', parent);\n    }\n\n    childElement.addEventListener('click', function (e) {\n      e.stopPropagation();\n    }, false);\n    content.appendChild(childElement);\n  }\n\n  el.appendChild(content);\n  return el;\n}\n/**\n * Create button element for toolbar.\n */\n\n\nfunction createToolbarButton(options, enableActions, enableTooltips, shortcuts, markup, parent) {\n  options = options || {};\n  var el = document.createElement(markup); // Add 'custom' attributes as early as possible, so that 'official' attributes will never be overwritten.\n\n  if (options.attributes) {\n    for (var attribute in options.attributes) {\n      if (Object.prototype.hasOwnProperty.call(options.attributes, attribute)) {\n        el.setAttribute(attribute, options.attributes[attribute]);\n      }\n    }\n  }\n\n  el.className = options.name;\n  el.setAttribute('type', markup);\n  enableTooltips = enableTooltips == undefined ? true : enableTooltips; // Properly hande custom shortcuts\n\n  if (options.name && options.name in shortcuts) {\n    bindings[options.name] = options.action;\n  }\n\n  if (options.title && enableTooltips) {\n    el.title = createTooltip(options.title, options.action, shortcuts);\n\n    if (isMac) {\n      el.title = el.title.replace('Ctrl', 'âŒ˜');\n      el.title = el.title.replace('Alt', 'âŒ¥');\n    }\n  }\n\n  if (options.noDisable) {\n    el.classList.add('no-disable');\n  }\n\n  if (options.noMobile) {\n    el.classList.add('no-mobile');\n  } // Prevent errors if there is no class name in custom options\n\n\n  var classNameParts = [];\n\n  if (typeof options.className !== 'undefined') {\n    classNameParts = options.className.split(' ');\n  } // Provide backwards compatibility with simple-markdown-editor by adding custom classes to the button.\n\n\n  var iconClasses = [];\n\n  for (var classNameIndex = 0; classNameIndex < classNameParts.length; classNameIndex++) {\n    var classNamePart = classNameParts[classNameIndex]; // Split icon classes from the button.\n    // Regex will detect \"fa\", \"fas\", \"fa-something\" and \"fa-some-icon-1\", but not \"fanfare\".\n\n    if (classNamePart.match(/^fa([srlb]|(-[\\w-]*)|$)/)) {\n      iconClasses.push(classNamePart);\n    } else {\n      el.classList.add(classNamePart);\n    }\n  }\n\n  el.tabIndex = -1; // Create icon element and append as a child to the button\n\n  var icon = document.createElement('i');\n\n  for (var iconClassIndex = 0; iconClassIndex < iconClasses.length; iconClassIndex++) {\n    var iconClass = iconClasses[iconClassIndex];\n    icon.classList.add(iconClass);\n  }\n\n  el.appendChild(icon); // If there is a custom icon markup set, use that\n\n  if (typeof options.icon !== 'undefined') {\n    el.innerHTML = options.icon;\n  }\n\n  if (options.action && enableActions) {\n    if (typeof options.action === 'function') {\n      el.onclick = function (e) {\n        e.preventDefault();\n        options.action(parent);\n      };\n    } else if (typeof options.action === 'string') {\n      el.onclick = function (e) {\n        e.preventDefault();\n        window.open(options.action, '_blank');\n      };\n    }\n  }\n\n  return el;\n}\n\nfunction createSep() {\n  var el = document.createElement('i');\n  el.className = 'separator';\n  el.innerHTML = '|';\n  return el;\n}\n\nfunction createTooltip(title, action, shortcuts) {\n  var actionName;\n  var tooltip = title;\n\n  if (action) {\n    actionName = getBindingName(action);\n\n    if (shortcuts[actionName]) {\n      tooltip += ' (' + fixShortcut(shortcuts[actionName]) + ')';\n    }\n  }\n\n  return tooltip;\n}\n/**\n * The state of CodeMirror at the given position.\n */\n\n\nfunction getState(cm, pos) {\n  pos = pos || cm.getCursor('start');\n  var stat = cm.getTokenAt(pos);\n  if (!stat.type) return {};\n  var types = stat.type.split(' ');\n  var ret = {},\n      data,\n      text;\n\n  for (var i = 0; i < types.length; i++) {\n    data = types[i];\n\n    if (data === 'strong') {\n      ret.bold = true;\n    } else if (data === 'variable-2') {\n      text = cm.getLine(pos.line);\n\n      if (/^\\s*\\d+\\.\\s/.test(text)) {\n        ret['ordered-list'] = true;\n      } else {\n        ret['unordered-list'] = true;\n      }\n    } else if (data === 'atom') {\n      ret.quote = true;\n    } else if (data === 'em') {\n      ret.italic = true;\n    } else if (data === 'quote') {\n      ret.quote = true;\n    } else if (data === 'strikethrough') {\n      ret.strikethrough = true;\n    } else if (data === 'comment') {\n      ret.code = true;\n    } else if (data === 'link') {\n      ret.link = true;\n    } else if (data === 'tag') {\n      ret.image = true;\n    } else if (data.match(/^header(-[1-6])?$/)) {\n      ret[data.replace('header', 'heading')] = true;\n    }\n  }\n\n  return ret;\n} // Saved overflow setting\n\n\nvar saved_overflow = '';\n/**\n * Toggle full screen of the editor.\n */\n\nfunction toggleFullScreen(editor) {\n  // Set fullscreen\n  var cm = editor.codemirror;\n  cm.setOption('fullScreen', !cm.getOption('fullScreen')); // Prevent scrolling on body during fullscreen active\n\n  if (cm.getOption('fullScreen')) {\n    saved_overflow = document.body.style.overflow;\n    document.body.style.overflow = 'hidden';\n  } else {\n    document.body.style.overflow = saved_overflow;\n  }\n\n  var wrapper = cm.getWrapperElement();\n  var sidebyside = wrapper.nextSibling;\n\n  if (/editor-preview-active-side/.test(sidebyside.className)) {\n    if (editor.options.sideBySideFullscreen === false) {\n      // if side-by-side not-fullscreen ok, apply classes as needed\n      var easyMDEContainer = wrapper.parentNode;\n\n      if (cm.getOption('fullScreen')) {\n        removeClass(easyMDEContainer, 'sided--no-fullscreen');\n      } else {\n        addClass(easyMDEContainer, 'sided--no-fullscreen');\n      }\n    } else {\n      toggleSideBySide(editor);\n    }\n  }\n\n  if (editor.options.onToggleFullScreen) {\n    editor.options.onToggleFullScreen(cm.getOption('fullScreen') || false);\n  } // Remove or set maxHeight\n\n\n  if (typeof editor.options.maxHeight !== 'undefined') {\n    if (cm.getOption('fullScreen')) {\n      cm.getScrollerElement().style.removeProperty('height');\n      sidebyside.style.removeProperty('height');\n    } else {\n      cm.getScrollerElement().style.height = editor.options.maxHeight;\n      editor.setPreviewMaxHeight();\n    }\n  } // Update toolbar class\n\n\n  if (!/fullscreen/.test(editor.toolbar_div.className)) {\n    editor.toolbar_div.className += ' fullscreen';\n  } else {\n    editor.toolbar_div.className = editor.toolbar_div.className.replace(/\\s*fullscreen\\b/, '');\n  } // Update toolbar button\n\n\n  if (editor.toolbarElements && editor.toolbarElements.fullscreen) {\n    var toolbarButton = editor.toolbarElements.fullscreen;\n\n    if (!/active/.test(toolbarButton.className)) {\n      toolbarButton.className += ' active';\n    } else {\n      toolbarButton.className = toolbarButton.className.replace(/\\s*active\\s*/g, '');\n    }\n  }\n}\n/**\n * Action for toggling bold.\n */\n\n\nfunction toggleBold(editor) {\n  _toggleBlock(editor, 'bold', editor.options.blockStyles.bold);\n}\n/**\n * Action for toggling italic.\n */\n\n\nfunction toggleItalic(editor) {\n  _toggleBlock(editor, 'italic', editor.options.blockStyles.italic);\n}\n/**\n * Action for toggling strikethrough.\n */\n\n\nfunction toggleStrikethrough(editor) {\n  _toggleBlock(editor, 'strikethrough', '~~');\n}\n/**\n * Action for toggling code block.\n */\n\n\nfunction toggleCodeBlock(editor) {\n  var fenceCharsToInsert = editor.options.blockStyles.code;\n\n  function fencing_line(line) {\n    /* return true, if this is a ``` or ~~~ line */\n    if (typeof line !== 'object') {\n      throw 'fencing_line() takes a \\'line\\' object (not a line number, or line text).  Got: ' + typeof line + ': ' + line;\n    }\n\n    return line.styles && line.styles[2] && line.styles[2].indexOf('formatting-code-block') !== -1;\n  }\n\n  function token_state(token) {\n    // base goes an extra level deep when mode backdrops are used, e.g. spellchecker on\n    return token.state.base.base || token.state.base;\n  }\n\n  function code_type(cm, line_num, line, firstTok, lastTok) {\n    /*\n     * Return \"single\", \"indented\", \"fenced\" or false\n     *\n     * cm and line_num are required.  Others are optional for efficiency\n     *   To check in the middle of a line, pass in firstTok yourself.\n     */\n    line = line || cm.getLineHandle(line_num);\n    firstTok = firstTok || cm.getTokenAt({\n      line: line_num,\n      ch: 1\n    });\n    lastTok = lastTok || !!line.text && cm.getTokenAt({\n      line: line_num,\n      ch: line.text.length - 1\n    });\n    var types = firstTok.type ? firstTok.type.split(' ') : [];\n\n    if (lastTok && token_state(lastTok).indentedCode) {\n      // have to check last char, since first chars of first line aren\"t marked as indented\n      return 'indented';\n    } else if (types.indexOf('comment') === -1) {\n      // has to be after \"indented\" check, since first chars of first indented line aren\"t marked as such\n      return false;\n    } else if (token_state(firstTok).fencedChars || token_state(lastTok).fencedChars || fencing_line(line)) {\n      return 'fenced';\n    } else {\n      return 'single';\n    }\n  }\n\n  function insertFencingAtSelection(cm, cur_start, cur_end, fenceCharsToInsert) {\n    var start_line_sel = cur_start.line + 1,\n        end_line_sel = cur_end.line + 1,\n        sel_multi = cur_start.line !== cur_end.line,\n        repl_start = fenceCharsToInsert + '\\n',\n        repl_end = '\\n' + fenceCharsToInsert;\n\n    if (sel_multi) {\n      end_line_sel++;\n    } // handle last char including \\n or not\n\n\n    if (sel_multi && cur_end.ch === 0) {\n      repl_end = fenceCharsToInsert + '\\n';\n      end_line_sel--;\n    }\n\n    _replaceSelection(cm, false, [repl_start, repl_end]);\n\n    cm.setSelection({\n      line: start_line_sel,\n      ch: 0\n    }, {\n      line: end_line_sel,\n      ch: 0\n    });\n  }\n\n  var cm = editor.codemirror,\n      cur_start = cm.getCursor('start'),\n      cur_end = cm.getCursor('end'),\n      tok = cm.getTokenAt({\n    line: cur_start.line,\n    ch: cur_start.ch || 1\n  }),\n      // avoid ch 0 which is a cursor pos but not token\n  line = cm.getLineHandle(cur_start.line),\n      is_code = code_type(cm, cur_start.line, line, tok);\n  var block_start, block_end, lineCount;\n\n  if (is_code === 'single') {\n    // similar to some EasyMDE _toggleBlock logic\n    var start = line.text.slice(0, cur_start.ch).replace('`', ''),\n        end = line.text.slice(cur_start.ch).replace('`', '');\n    cm.replaceRange(start + end, {\n      line: cur_start.line,\n      ch: 0\n    }, {\n      line: cur_start.line,\n      ch: 99999999999999\n    });\n    cur_start.ch--;\n\n    if (cur_start !== cur_end) {\n      cur_end.ch--;\n    }\n\n    cm.setSelection(cur_start, cur_end);\n    cm.focus();\n  } else if (is_code === 'fenced') {\n    if (cur_start.line !== cur_end.line || cur_start.ch !== cur_end.ch) {\n      // use selection\n      // find the fenced line so we know what type it is (tilde, backticks, number of them)\n      for (block_start = cur_start.line; block_start >= 0; block_start--) {\n        line = cm.getLineHandle(block_start);\n\n        if (fencing_line(line)) {\n          break;\n        }\n      }\n\n      var fencedTok = cm.getTokenAt({\n        line: block_start,\n        ch: 1\n      });\n      var fence_chars = token_state(fencedTok).fencedChars;\n      var start_text, start_line;\n      var end_text, end_line; // check for selection going up against fenced lines, in which case we don't want to add more fencing\n\n      if (fencing_line(cm.getLineHandle(cur_start.line))) {\n        start_text = '';\n        start_line = cur_start.line;\n      } else if (fencing_line(cm.getLineHandle(cur_start.line - 1))) {\n        start_text = '';\n        start_line = cur_start.line - 1;\n      } else {\n        start_text = fence_chars + '\\n';\n        start_line = cur_start.line;\n      }\n\n      if (fencing_line(cm.getLineHandle(cur_end.line))) {\n        end_text = '';\n        end_line = cur_end.line;\n\n        if (cur_end.ch === 0) {\n          end_line += 1;\n        }\n      } else if (cur_end.ch !== 0 && fencing_line(cm.getLineHandle(cur_end.line + 1))) {\n        end_text = '';\n        end_line = cur_end.line + 1;\n      } else {\n        end_text = fence_chars + '\\n';\n        end_line = cur_end.line + 1;\n      }\n\n      if (cur_end.ch === 0) {\n        // full last line selected, putting cursor at beginning of next\n        end_line -= 1;\n      }\n\n      cm.operation(function () {\n        // end line first, so that line numbers don't change\n        cm.replaceRange(end_text, {\n          line: end_line,\n          ch: 0\n        }, {\n          line: end_line + (end_text ? 0 : 1),\n          ch: 0\n        });\n        cm.replaceRange(start_text, {\n          line: start_line,\n          ch: 0\n        }, {\n          line: start_line + (start_text ? 0 : 1),\n          ch: 0\n        });\n      });\n      cm.setSelection({\n        line: start_line + (start_text ? 1 : 0),\n        ch: 0\n      }, {\n        line: end_line + (start_text ? 1 : -1),\n        ch: 0\n      });\n      cm.focus();\n    } else {\n      // no selection, search for ends of this fenced block\n      var search_from = cur_start.line;\n\n      if (fencing_line(cm.getLineHandle(cur_start.line))) {\n        // gets a little tricky if cursor is right on a fenced line\n        if (code_type(cm, cur_start.line + 1) === 'fenced') {\n          block_start = cur_start.line;\n          search_from = cur_start.line + 1; // for searching for \"end\"\n        } else {\n          block_end = cur_start.line;\n          search_from = cur_start.line - 1; // for searching for \"start\"\n        }\n      }\n\n      if (block_start === undefined) {\n        for (block_start = search_from; block_start >= 0; block_start--) {\n          line = cm.getLineHandle(block_start);\n\n          if (fencing_line(line)) {\n            break;\n          }\n        }\n      }\n\n      if (block_end === undefined) {\n        lineCount = cm.lineCount();\n\n        for (block_end = search_from; block_end < lineCount; block_end++) {\n          line = cm.getLineHandle(block_end);\n\n          if (fencing_line(line)) {\n            break;\n          }\n        }\n      }\n\n      cm.operation(function () {\n        cm.replaceRange('', {\n          line: block_start,\n          ch: 0\n        }, {\n          line: block_start + 1,\n          ch: 0\n        });\n        cm.replaceRange('', {\n          line: block_end - 1,\n          ch: 0\n        }, {\n          line: block_end,\n          ch: 0\n        });\n      });\n      cm.focus();\n    }\n  } else if (is_code === 'indented') {\n    if (cur_start.line !== cur_end.line || cur_start.ch !== cur_end.ch) {\n      // use selection\n      block_start = cur_start.line;\n      block_end = cur_end.line;\n\n      if (cur_end.ch === 0) {\n        block_end--;\n      }\n    } else {\n      // no selection, search for ends of this indented block\n      for (block_start = cur_start.line; block_start >= 0; block_start--) {\n        line = cm.getLineHandle(block_start);\n\n        if (line.text.match(/^\\s*$/)) {\n          // empty or all whitespace - keep going\n          continue;\n        } else {\n          if (code_type(cm, block_start, line) !== 'indented') {\n            block_start += 1;\n            break;\n          }\n        }\n      }\n\n      lineCount = cm.lineCount();\n\n      for (block_end = cur_start.line; block_end < lineCount; block_end++) {\n        line = cm.getLineHandle(block_end);\n\n        if (line.text.match(/^\\s*$/)) {\n          // empty or all whitespace - keep going\n          continue;\n        } else {\n          if (code_type(cm, block_end, line) !== 'indented') {\n            block_end -= 1;\n            break;\n          }\n        }\n      }\n    } // if we are going to un-indent based on a selected set of lines, and the next line is indented too, we need to\n    // insert a blank line so that the next line(s) continue to be indented code\n\n\n    var next_line = cm.getLineHandle(block_end + 1),\n        next_line_last_tok = next_line && cm.getTokenAt({\n      line: block_end + 1,\n      ch: next_line.text.length - 1\n    }),\n        next_line_indented = next_line_last_tok && token_state(next_line_last_tok).indentedCode;\n\n    if (next_line_indented) {\n      cm.replaceRange('\\n', {\n        line: block_end + 1,\n        ch: 0\n      });\n    }\n\n    for (var i = block_start; i <= block_end; i++) {\n      cm.indentLine(i, 'subtract'); // TODO: this doesn't get tracked in the history, so can't be undone :(\n    }\n\n    cm.focus();\n  } else {\n    // insert code formatting\n    var no_sel_and_starting_of_line = cur_start.line === cur_end.line && cur_start.ch === cur_end.ch && cur_start.ch === 0;\n    var sel_multi = cur_start.line !== cur_end.line;\n\n    if (no_sel_and_starting_of_line || sel_multi) {\n      insertFencingAtSelection(cm, cur_start, cur_end, fenceCharsToInsert);\n    } else {\n      _replaceSelection(cm, false, ['`', '`']);\n    }\n  }\n}\n/**\n * Action for toggling blockquote.\n */\n\n\nfunction toggleBlockquote(editor) {\n  var cm = editor.codemirror;\n\n  _toggleLine(cm, 'quote');\n}\n/**\n * Action for toggling heading size: normal -> h1 -> h2 -> h3 -> h4 -> h5 -> h6 -> normal\n */\n\n\nfunction toggleHeadingSmaller(editor) {\n  var cm = editor.codemirror;\n\n  _toggleHeading(cm, 'smaller');\n}\n/**\n * Action for toggling heading size: normal -> h6 -> h5 -> h4 -> h3 -> h2 -> h1 -> normal\n */\n\n\nfunction toggleHeadingBigger(editor) {\n  var cm = editor.codemirror;\n\n  _toggleHeading(cm, 'bigger');\n}\n/**\n * Action for toggling heading size 1\n */\n\n\nfunction toggleHeading1(editor) {\n  var cm = editor.codemirror;\n\n  _toggleHeading(cm, undefined, 1);\n}\n/**\n * Action for toggling heading size 2\n */\n\n\nfunction toggleHeading2(editor) {\n  var cm = editor.codemirror;\n\n  _toggleHeading(cm, undefined, 2);\n}\n/**\n * Action for toggling heading size 3\n */\n\n\nfunction toggleHeading3(editor) {\n  var cm = editor.codemirror;\n\n  _toggleHeading(cm, undefined, 3);\n}\n/**\n * Action for toggling ul.\n */\n\n\nfunction toggleUnorderedList(editor) {\n  var cm = editor.codemirror;\n  var listStyle = '*'; // Default\n\n  if (['-', '+', '*'].includes(editor.options.unorderedListStyle)) {\n    listStyle = editor.options.unorderedListStyle;\n  }\n\n  _toggleLine(cm, 'unordered-list', listStyle);\n}\n/**\n * Action for toggling ol.\n */\n\n\nfunction toggleOrderedList(editor) {\n  var cm = editor.codemirror;\n\n  _toggleLine(cm, 'ordered-list');\n}\n/**\n * Action for clean block (remove headline, list, blockquote code, markers)\n */\n\n\nfunction cleanBlock(editor) {\n  var cm = editor.codemirror;\n\n  _cleanBlock(cm);\n}\n/**\n * Action for drawing a link.\n */\n\n\nfunction drawLink(editor) {\n  var cm = editor.codemirror;\n  var stat = getState(cm);\n  var options = editor.options;\n  var url = 'https://';\n\n  if (options.promptURLs) {\n    url = prompt(options.promptTexts.link, 'https://');\n\n    if (!url) {\n      return false;\n    }\n  }\n\n  _replaceSelection(cm, stat.link, options.insertTexts.link, url);\n}\n/**\n * Action for drawing an img.\n */\n\n\nfunction drawImage(editor) {\n  var cm = editor.codemirror;\n  var stat = getState(cm);\n  var options = editor.options;\n  var url = 'https://';\n\n  if (options.promptURLs) {\n    url = prompt(options.promptTexts.image, 'https://');\n\n    if (!url) {\n      return false;\n    }\n  }\n\n  _replaceSelection(cm, stat.image, options.insertTexts.image, url);\n}\n/**\n * Action for opening the browse-file window to upload an image to a server.\n * @param editor {EasyMDE} The EasyMDE object\n */\n\n\nfunction drawUploadedImage(editor) {\n  // TODO: Draw the image template with a fake url? ie: '![](importing foo.png...)'\n  editor.openBrowseFileWindow();\n}\n/**\n * Action executed after an image have been successfully imported on the server.\n * @param editor {EasyMDE} The EasyMDE object\n * @param url {string} The url of the uploaded image\n */\n\n\nfunction afterImageUploaded(editor, url) {\n  var cm = editor.codemirror;\n  var stat = getState(cm);\n  var options = editor.options;\n  var imageName = url.substr(url.lastIndexOf('/') + 1);\n  var ext = imageName.substring(imageName.lastIndexOf('.') + 1).replace(/\\?.*$/, '').toLowerCase(); // Check if media is an image\n\n  if (['png', 'jpg', 'jpeg', 'gif', 'svg'].includes(ext)) {\n    _replaceSelection(cm, stat.image, options.insertTexts.uploadedImage, url);\n  } else {\n    var text_link = options.insertTexts.link;\n    text_link[0] = '[' + imageName;\n\n    _replaceSelection(cm, stat.link, text_link, url);\n  } // show uploaded image filename for 1000ms\n\n\n  editor.updateStatusBar('upload-image', editor.options.imageTexts.sbOnUploaded.replace('#image_name#', imageName));\n  setTimeout(function () {\n    editor.updateStatusBar('upload-image', editor.options.imageTexts.sbInit);\n  }, 1000);\n}\n/**\n * Action for drawing a table.\n */\n\n\nfunction drawTable(editor) {\n  var cm = editor.codemirror;\n  var stat = getState(cm);\n  var options = editor.options;\n\n  _replaceSelection(cm, stat.table, options.insertTexts.table);\n}\n/**\n * Action for drawing a horizontal rule.\n */\n\n\nfunction drawHorizontalRule(editor) {\n  var cm = editor.codemirror;\n  var stat = getState(cm);\n  var options = editor.options;\n\n  _replaceSelection(cm, stat.image, options.insertTexts.horizontalRule);\n}\n/**\n * Undo action.\n */\n\n\nfunction undo(editor) {\n  var cm = editor.codemirror;\n  cm.undo();\n  cm.focus();\n}\n/**\n * Redo action.\n */\n\n\nfunction redo(editor) {\n  var cm = editor.codemirror;\n  cm.redo();\n  cm.focus();\n}\n/**\n * Toggle side by side preview\n */\n\n\nfunction toggleSideBySide(editor) {\n  var cm = editor.codemirror;\n  var wrapper = cm.getWrapperElement();\n  var preview = wrapper.nextSibling;\n  var toolbarButton = editor.toolbarElements && editor.toolbarElements['side-by-side'];\n  var useSideBySideListener = false;\n  var easyMDEContainer = wrapper.parentNode;\n\n  if (/editor-preview-active-side/.test(preview.className)) {\n    if (editor.options.sideBySideFullscreen === false) {\n      // if side-by-side not-fullscreen ok, remove classes when hiding side\n      removeClass(easyMDEContainer, 'sided--no-fullscreen');\n    }\n\n    preview.className = preview.className.replace(/\\s*editor-preview-active-side\\s*/g, '');\n    if (toolbarButton) toolbarButton.className = toolbarButton.className.replace(/\\s*active\\s*/g, '');\n    wrapper.className = wrapper.className.replace(/\\s*CodeMirror-sided\\s*/g, ' ');\n  } else {\n    // When the preview button is clicked for the first time,\n    // give some time for the transition from editor.css to fire and the view to slide from right to left,\n    // instead of just appearing.\n    setTimeout(function () {\n      if (!cm.getOption('fullScreen')) {\n        if (editor.options.sideBySideFullscreen === false) {\n          // if side-by-side not-fullscreen ok, add classes when not fullscreen and showing side\n          addClass(easyMDEContainer, 'sided--no-fullscreen');\n        } else {\n          toggleFullScreen(editor);\n        }\n      }\n\n      preview.className += ' editor-preview-active-side';\n    }, 1);\n    if (toolbarButton) toolbarButton.className += ' active';\n    wrapper.className += ' CodeMirror-sided';\n    useSideBySideListener = true;\n  } // Hide normal preview if active\n\n\n  var previewNormal = wrapper.lastChild;\n\n  if (/editor-preview-active/.test(previewNormal.className)) {\n    previewNormal.className = previewNormal.className.replace(/\\s*editor-preview-active\\s*/g, '');\n    var toolbar = editor.toolbarElements.preview;\n    var toolbar_div = editor.toolbar_div;\n    toolbar.className = toolbar.className.replace(/\\s*active\\s*/g, '');\n    toolbar_div.className = toolbar_div.className.replace(/\\s*disabled-for-preview*/g, '');\n  }\n\n  var sideBySideRenderingFunction = function () {\n    var newValue = editor.options.previewRender(editor.value(), preview);\n\n    if (newValue != null) {\n      preview.innerHTML = newValue;\n    }\n  };\n\n  if (!cm.sideBySideRenderingFunction) {\n    cm.sideBySideRenderingFunction = sideBySideRenderingFunction;\n  }\n\n  if (useSideBySideListener) {\n    var newValue = editor.options.previewRender(editor.value(), preview);\n\n    if (newValue != null) {\n      preview.innerHTML = newValue;\n    }\n\n    cm.on('update', cm.sideBySideRenderingFunction);\n  } else {\n    cm.off('update', cm.sideBySideRenderingFunction);\n  } // Refresh to fix selection being off (#309)\n\n\n  cm.refresh();\n}\n/**\n * Preview action.\n */\n\n\nfunction togglePreview(editor) {\n  var cm = editor.codemirror;\n  var wrapper = cm.getWrapperElement();\n  var toolbar_div = editor.toolbar_div;\n  var toolbar = editor.options.toolbar ? editor.toolbarElements.preview : false;\n  var preview = wrapper.lastChild; // Turn off side by side if needed\n\n  var sidebyside = cm.getWrapperElement().nextSibling;\n  if (/editor-preview-active-side/.test(sidebyside.className)) toggleSideBySide(editor);\n\n  if (!preview || !/editor-preview-full/.test(preview.className)) {\n    preview = document.createElement('div');\n    preview.className = 'editor-preview-full';\n\n    if (editor.options.previewClass) {\n      if (Array.isArray(editor.options.previewClass)) {\n        for (var i = 0; i < editor.options.previewClass.length; i++) {\n          preview.className += ' ' + editor.options.previewClass[i];\n        }\n      } else if (typeof editor.options.previewClass === 'string') {\n        preview.className += ' ' + editor.options.previewClass;\n      }\n    }\n\n    wrapper.appendChild(preview);\n  }\n\n  if (/editor-preview-active/.test(preview.className)) {\n    preview.className = preview.className.replace(/\\s*editor-preview-active\\s*/g, '');\n\n    if (toolbar) {\n      toolbar.className = toolbar.className.replace(/\\s*active\\s*/g, '');\n      toolbar_div.className = toolbar_div.className.replace(/\\s*disabled-for-preview*/g, '');\n    }\n  } else {\n    // When the preview button is clicked for the first time,\n    // give some time for the transition from editor.css to fire and the view to slide from right to left,\n    // instead of just appearing.\n    setTimeout(function () {\n      preview.className += ' editor-preview-active';\n    }, 1);\n\n    if (toolbar) {\n      toolbar.className += ' active';\n      toolbar_div.className += ' disabled-for-preview';\n    }\n  }\n\n  preview.innerHTML = editor.options.previewRender(editor.value(), preview);\n}\n\nfunction _replaceSelection(cm, active, startEnd, url) {\n  if (/editor-preview-active/.test(cm.getWrapperElement().lastChild.className)) return;\n  var text;\n  var start = startEnd[0];\n  var end = startEnd[1];\n  var startPoint = {},\n      endPoint = {};\n  Object.assign(startPoint, cm.getCursor('start'));\n  Object.assign(endPoint, cm.getCursor('end'));\n\n  if (url) {\n    start = start.replace('#url#', url); // url is in start for upload-image\n\n    end = end.replace('#url#', url);\n  }\n\n  if (active) {\n    text = cm.getLine(startPoint.line);\n    start = text.slice(0, startPoint.ch);\n    end = text.slice(startPoint.ch);\n    cm.replaceRange(start + end, {\n      line: startPoint.line,\n      ch: 0\n    });\n  } else {\n    text = cm.getSelection();\n    cm.replaceSelection(start + text + end);\n    startPoint.ch += start.length;\n\n    if (startPoint !== endPoint) {\n      endPoint.ch += start.length;\n    }\n  }\n\n  cm.setSelection(startPoint, endPoint);\n  cm.focus();\n}\n\nfunction _toggleHeading(cm, direction, size) {\n  if (/editor-preview-active/.test(cm.getWrapperElement().lastChild.className)) return;\n  var startPoint = cm.getCursor('start');\n  var endPoint = cm.getCursor('end');\n\n  for (var i = startPoint.line; i <= endPoint.line; i++) {\n    (function (i) {\n      var text = cm.getLine(i);\n      var currHeadingLevel = text.search(/[^#]/);\n\n      if (direction !== undefined) {\n        if (currHeadingLevel <= 0) {\n          if (direction == 'bigger') {\n            text = '###### ' + text;\n          } else {\n            text = '# ' + text;\n          }\n        } else if (currHeadingLevel == 6 && direction == 'smaller') {\n          text = text.substr(7);\n        } else if (currHeadingLevel == 1 && direction == 'bigger') {\n          text = text.substr(2);\n        } else {\n          if (direction == 'bigger') {\n            text = text.substr(1);\n          } else {\n            text = '#' + text;\n          }\n        }\n      } else {\n        if (size == 1) {\n          if (currHeadingLevel <= 0) {\n            text = '# ' + text;\n          } else if (currHeadingLevel == size) {\n            text = text.substr(currHeadingLevel + 1);\n          } else {\n            text = '# ' + text.substr(currHeadingLevel + 1);\n          }\n        } else if (size == 2) {\n          if (currHeadingLevel <= 0) {\n            text = '## ' + text;\n          } else if (currHeadingLevel == size) {\n            text = text.substr(currHeadingLevel + 1);\n          } else {\n            text = '## ' + text.substr(currHeadingLevel + 1);\n          }\n        } else {\n          if (currHeadingLevel <= 0) {\n            text = '### ' + text;\n          } else if (currHeadingLevel == size) {\n            text = text.substr(currHeadingLevel + 1);\n          } else {\n            text = '### ' + text.substr(currHeadingLevel + 1);\n          }\n        }\n      }\n\n      cm.replaceRange(text, {\n        line: i,\n        ch: 0\n      }, {\n        line: i,\n        ch: 99999999999999\n      });\n    })(i);\n  }\n\n  cm.focus();\n}\n\nfunction _toggleLine(cm, name, liststyle) {\n  if (/editor-preview-active/.test(cm.getWrapperElement().lastChild.className)) return;\n  var listRegexp = /^(\\s*)(\\*|-|\\+|\\d*\\.)(\\s+)/;\n  var whitespacesRegexp = /^\\s*/;\n  var stat = getState(cm);\n  var startPoint = cm.getCursor('start');\n  var endPoint = cm.getCursor('end');\n  var repl = {\n    'quote': /^(\\s*)>\\s+/,\n    'unordered-list': listRegexp,\n    'ordered-list': listRegexp\n  };\n\n  var _getChar = function (name, i) {\n    var map = {\n      'quote': '>',\n      'unordered-list': liststyle,\n      'ordered-list': '%%i.'\n    };\n    return map[name].replace('%%i', i);\n  };\n\n  var _checkChar = function (name, char) {\n    var map = {\n      'quote': '>',\n      'unordered-list': '\\\\' + liststyle,\n      'ordered-list': '\\\\d+.'\n    };\n    var rt = new RegExp(map[name]);\n    return char && rt.test(char);\n  };\n\n  var _toggle = function (name, text, untoggleOnly) {\n    var arr = listRegexp.exec(text);\n\n    var char = _getChar(name, line);\n\n    if (arr !== null) {\n      if (_checkChar(name, arr[2])) {\n        char = '';\n      }\n\n      text = arr[1] + char + arr[3] + text.replace(whitespacesRegexp, '').replace(repl[name], '$1');\n    } else if (untoggleOnly == false) {\n      text = char + ' ' + text;\n    }\n\n    return text;\n  };\n\n  var line = 1;\n\n  for (var i = startPoint.line; i <= endPoint.line; i++) {\n    (function (i) {\n      var text = cm.getLine(i);\n\n      if (stat[name]) {\n        text = text.replace(repl[name], '$1');\n      } else {\n        // If we're toggling unordered-list formatting, check if the current line\n        // is part of an ordered-list, and if so, untoggle that first.\n        // Workaround for https://github.com/Ionaru/easy-markdown-editor/issues/92\n        if (name == 'unordered-list') {\n          text = _toggle('ordered-list', text, true);\n        }\n\n        text = _toggle(name, text, false);\n        line += 1;\n      }\n\n      cm.replaceRange(text, {\n        line: i,\n        ch: 0\n      }, {\n        line: i,\n        ch: 99999999999999\n      });\n    })(i);\n  }\n\n  cm.focus();\n}\n\nfunction _toggleBlock(editor, type, start_chars, end_chars) {\n  if (/editor-preview-active/.test(editor.codemirror.getWrapperElement().lastChild.className)) return;\n  end_chars = typeof end_chars === 'undefined' ? start_chars : end_chars;\n  var cm = editor.codemirror;\n  var stat = getState(cm);\n  var text;\n  var start = start_chars;\n  var end = end_chars;\n  var startPoint = cm.getCursor('start');\n  var endPoint = cm.getCursor('end');\n\n  if (stat[type]) {\n    text = cm.getLine(startPoint.line);\n    start = text.slice(0, startPoint.ch);\n    end = text.slice(startPoint.ch);\n\n    if (type == 'bold') {\n      start = start.replace(/(\\*\\*|__)(?![\\s\\S]*(\\*\\*|__))/, '');\n      end = end.replace(/(\\*\\*|__)/, '');\n    } else if (type == 'italic') {\n      start = start.replace(/(\\*|_)(?![\\s\\S]*(\\*|_))/, '');\n      end = end.replace(/(\\*|_)/, '');\n    } else if (type == 'strikethrough') {\n      start = start.replace(/(\\*\\*|~~)(?![\\s\\S]*(\\*\\*|~~))/, '');\n      end = end.replace(/(\\*\\*|~~)/, '');\n    }\n\n    cm.replaceRange(start + end, {\n      line: startPoint.line,\n      ch: 0\n    }, {\n      line: startPoint.line,\n      ch: 99999999999999\n    });\n\n    if (type == 'bold' || type == 'strikethrough') {\n      startPoint.ch -= 2;\n\n      if (startPoint !== endPoint) {\n        endPoint.ch -= 2;\n      }\n    } else if (type == 'italic') {\n      startPoint.ch -= 1;\n\n      if (startPoint !== endPoint) {\n        endPoint.ch -= 1;\n      }\n    }\n  } else {\n    text = cm.getSelection();\n\n    if (type == 'bold') {\n      text = text.split('**').join('');\n      text = text.split('__').join('');\n    } else if (type == 'italic') {\n      text = text.split('*').join('');\n      text = text.split('_').join('');\n    } else if (type == 'strikethrough') {\n      text = text.split('~~').join('');\n    }\n\n    cm.replaceSelection(start + text + end);\n    startPoint.ch += start_chars.length;\n    endPoint.ch = startPoint.ch + text.length;\n  }\n\n  cm.setSelection(startPoint, endPoint);\n  cm.focus();\n}\n\nfunction _cleanBlock(cm) {\n  if (/editor-preview-active/.test(cm.getWrapperElement().lastChild.className)) return;\n  var startPoint = cm.getCursor('start');\n  var endPoint = cm.getCursor('end');\n  var text;\n\n  for (var line = startPoint.line; line <= endPoint.line; line++) {\n    text = cm.getLine(line);\n    text = text.replace(/^[ ]*([# ]+|\\*|-|[> ]+|[0-9]+(.|\\)))[ ]*/, '');\n    cm.replaceRange(text, {\n      line: line,\n      ch: 0\n    }, {\n      line: line,\n      ch: 99999999999999\n    });\n  }\n}\n/**\n * Convert a number of bytes to a human-readable file size. If you desire\n * to add a space between the value and the unit, you need to add this space\n * to the given units.\n * @param bytes {integer} A number of bytes, as integer. Ex: 421137\n * @param units {number[]} An array of human-readable units, ie. [' B', ' K', ' MB']\n * @returns string A human-readable file size. Ex: '412 KB'\n */\n\n\nfunction humanFileSize(bytes, units) {\n  if (Math.abs(bytes) < 1024) {\n    return '' + bytes + units[0];\n  }\n\n  var u = 0;\n\n  do {\n    bytes /= 1024;\n    ++u;\n  } while (Math.abs(bytes) >= 1024 && u < units.length);\n\n  return '' + bytes.toFixed(1) + units[u];\n} // Merge the properties of one object into another.\n\n\nfunction _mergeProperties(target, source) {\n  for (var property in source) {\n    if (Object.prototype.hasOwnProperty.call(source, property)) {\n      if (source[property] instanceof Array) {\n        target[property] = source[property].concat(target[property] instanceof Array ? target[property] : []);\n      } else if (source[property] !== null && typeof source[property] === 'object' && source[property].constructor === Object) {\n        target[property] = _mergeProperties(target[property] || {}, source[property]);\n      } else {\n        target[property] = source[property];\n      }\n    }\n  }\n\n  return target;\n} // Merge an arbitrary number of objects into one.\n\n\nfunction extend(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    target = _mergeProperties(target, arguments[i]);\n  }\n\n  return target;\n}\n/* The right word count in respect for CJK. */\n\n\nfunction wordCount(data) {\n  var pattern = /[a-zA-Z0-9_\\u00A0-\\u02AF\\u0392-\\u03c9\\u0410-\\u04F9]+|[\\u4E00-\\u9FFF\\u3400-\\u4dbf\\uf900-\\ufaff\\u3040-\\u309f\\uac00-\\ud7af]+/g;\n  var m = data.match(pattern);\n  var count = 0;\n  if (m === null) return count;\n\n  for (var i = 0; i < m.length; i++) {\n    if (m[i].charCodeAt(0) >= 0x4E00) {\n      count += m[i].length;\n    } else {\n      count += 1;\n    }\n  }\n\n  return count;\n}\n\nvar toolbarBuiltInButtons = {\n  'bold': {\n    name: 'bold',\n    action: toggleBold,\n    className: 'fa fa-bold',\n    title: 'Bold',\n    default: true\n  },\n  'italic': {\n    name: 'italic',\n    action: toggleItalic,\n    className: 'fa fa-italic',\n    title: 'Italic',\n    default: true\n  },\n  'strikethrough': {\n    name: 'strikethrough',\n    action: toggleStrikethrough,\n    className: 'fa fa-strikethrough',\n    title: 'Strikethrough'\n  },\n  'heading': {\n    name: 'heading',\n    action: toggleHeadingSmaller,\n    className: 'fa fa-header fa-heading',\n    title: 'Heading',\n    default: true\n  },\n  'heading-smaller': {\n    name: 'heading-smaller',\n    action: toggleHeadingSmaller,\n    className: 'fa fa-header fa-heading header-smaller',\n    title: 'Smaller Heading'\n  },\n  'heading-bigger': {\n    name: 'heading-bigger',\n    action: toggleHeadingBigger,\n    className: 'fa fa-header fa-heading header-bigger',\n    title: 'Bigger Heading'\n  },\n  'heading-1': {\n    name: 'heading-1',\n    action: toggleHeading1,\n    className: 'fa fa-header fa-heading header-1',\n    title: 'Big Heading'\n  },\n  'heading-2': {\n    name: 'heading-2',\n    action: toggleHeading2,\n    className: 'fa fa-header fa-heading header-2',\n    title: 'Medium Heading'\n  },\n  'heading-3': {\n    name: 'heading-3',\n    action: toggleHeading3,\n    className: 'fa fa-header fa-heading header-3',\n    title: 'Small Heading'\n  },\n  'separator-1': {\n    name: 'separator-1'\n  },\n  'code': {\n    name: 'code',\n    action: toggleCodeBlock,\n    className: 'fa fa-code',\n    title: 'Code'\n  },\n  'quote': {\n    name: 'quote',\n    action: toggleBlockquote,\n    className: 'fa fa-quote-left',\n    title: 'Quote',\n    default: true\n  },\n  'unordered-list': {\n    name: 'unordered-list',\n    action: toggleUnorderedList,\n    className: 'fa fa-list-ul',\n    title: 'Generic List',\n    default: true\n  },\n  'ordered-list': {\n    name: 'ordered-list',\n    action: toggleOrderedList,\n    className: 'fa fa-list-ol',\n    title: 'Numbered List',\n    default: true\n  },\n  'clean-block': {\n    name: 'clean-block',\n    action: cleanBlock,\n    className: 'fa fa-eraser',\n    title: 'Clean block'\n  },\n  'separator-2': {\n    name: 'separator-2'\n  },\n  'link': {\n    name: 'link',\n    action: drawLink,\n    className: 'fa fa-link',\n    title: 'Create Link',\n    default: true\n  },\n  'image': {\n    name: 'image',\n    action: drawImage,\n    className: 'fa fa-image',\n    title: 'Insert Image',\n    default: true\n  },\n  'upload-image': {\n    name: 'upload-image',\n    action: drawUploadedImage,\n    className: 'fa fa-image',\n    title: 'Import an image'\n  },\n  'table': {\n    name: 'table',\n    action: drawTable,\n    className: 'fa fa-table',\n    title: 'Insert Table'\n  },\n  'horizontal-rule': {\n    name: 'horizontal-rule',\n    action: drawHorizontalRule,\n    className: 'fa fa-minus',\n    title: 'Insert Horizontal Line'\n  },\n  'separator-3': {\n    name: 'separator-3'\n  },\n  'preview': {\n    name: 'preview',\n    action: togglePreview,\n    className: 'fa fa-eye',\n    noDisable: true,\n    title: 'Toggle Preview',\n    default: true\n  },\n  'side-by-side': {\n    name: 'side-by-side',\n    action: toggleSideBySide,\n    className: 'fa fa-columns',\n    noDisable: true,\n    noMobile: true,\n    title: 'Toggle Side by Side',\n    default: true\n  },\n  'fullscreen': {\n    name: 'fullscreen',\n    action: toggleFullScreen,\n    className: 'fa fa-arrows-alt',\n    noDisable: true,\n    noMobile: true,\n    title: 'Toggle Fullscreen',\n    default: true\n  },\n  'separator-4': {\n    name: 'separator-4'\n  },\n  'guide': {\n    name: 'guide',\n    action: 'https://www.markdownguide.org/basic-syntax/',\n    className: 'fa fa-question-circle',\n    noDisable: true,\n    title: 'Markdown Guide',\n    default: true\n  },\n  'separator-5': {\n    name: 'separator-5'\n  },\n  'undo': {\n    name: 'undo',\n    action: undo,\n    className: 'fa fa-undo',\n    noDisable: true,\n    title: 'Undo'\n  },\n  'redo': {\n    name: 'redo',\n    action: redo,\n    className: 'fa fa-repeat fa-redo',\n    noDisable: true,\n    title: 'Redo'\n  }\n};\nvar insertTexts = {\n  link: ['[', '](#url#)'],\n  image: ['![](', '#url#)'],\n  uploadedImage: ['![](#url#)', ''],\n  // uploadedImage: ['![](#url#)\\n', ''], // TODO: New line insertion doesn't work here.\n  table: ['', '\\n\\n| Column 1 | Column 2 | Column 3 |\\n| -------- | -------- | -------- |\\n| Text     | Text     | Text     |\\n\\n'],\n  horizontalRule: ['', '\\n\\n-----\\n\\n']\n};\nvar promptTexts = {\n  link: 'URL for the link:',\n  image: 'URL of the image:'\n};\nvar timeFormat = {\n  locale: 'en-US',\n  format: {\n    hour: '2-digit',\n    minute: '2-digit'\n  }\n};\nvar blockStyles = {\n  'bold': '**',\n  'code': '```',\n  'italic': '*'\n};\n/**\n * Texts displayed to the user (mainly on the status bar) for the import image\n * feature. Can be used for customization or internationalization.\n */\n\nvar imageTexts = {\n  sbInit: 'Attach files by drag and dropping or pasting from clipboard.',\n  sbOnDragEnter: 'Drop image to upload it.',\n  sbOnDrop: 'Uploading image #images_names#...',\n  sbProgress: 'Uploading #file_name#: #progress#%',\n  sbOnUploaded: 'Uploaded #image_name#',\n  sizeUnits: ' B, KB, MB'\n};\n/**\n * Errors displayed to the user, using the `errorCallback` option. Can be used for\n * customization or internationalization.\n */\n\nvar errorMessages = {\n  noFileGiven: 'You must select a file.',\n  typeNotAllowed: 'This image type is not allowed.',\n  fileTooLarge: 'Image #image_name# is too big (#image_size#).\\n' + 'Maximum file size is #image_max_size#.',\n  importError: 'Something went wrong when uploading the image #image_name#.'\n};\n/**\n * Interface of EasyMDE.\n */\n\nfunction EasyMDE(options) {\n  // Handle options parameter\n  options = options || {}; // Used later to refer to it\"s parent\n\n  options.parent = this; // Check if Font Awesome needs to be auto downloaded\n\n  var autoDownloadFA = true;\n\n  if (options.autoDownloadFontAwesome === false) {\n    autoDownloadFA = false;\n  }\n\n  if (options.autoDownloadFontAwesome !== true) {\n    var styleSheets = document.styleSheets;\n\n    for (var i = 0; i < styleSheets.length; i++) {\n      if (!styleSheets[i].href) continue;\n\n      if (styleSheets[i].href.indexOf('//maxcdn.bootstrapcdn.com/font-awesome/') > -1) {\n        autoDownloadFA = false;\n      }\n    }\n  }\n\n  if (autoDownloadFA) {\n    var link = document.createElement('link');\n    link.rel = 'stylesheet';\n    link.href = 'https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css';\n    document.getElementsByTagName('head')[0].appendChild(link);\n  } // Find the textarea to use\n\n\n  if (options.element) {\n    this.element = options.element;\n  } else if (options.element === null) {\n    // This means that the element option was specified, but no element was found\n    console.log('EasyMDE: Error. No element was found.');\n    return;\n  } // Handle toolbar\n\n\n  if (options.toolbar === undefined) {\n    // Initialize\n    options.toolbar = []; // Loop over the built in buttons, to get the preferred order\n\n    for (var key in toolbarBuiltInButtons) {\n      if (Object.prototype.hasOwnProperty.call(toolbarBuiltInButtons, key)) {\n        if (key.indexOf('separator-') != -1) {\n          options.toolbar.push('|');\n        }\n\n        if (toolbarBuiltInButtons[key].default === true || options.showIcons && options.showIcons.constructor === Array && options.showIcons.indexOf(key) != -1) {\n          options.toolbar.push(key);\n        }\n      }\n    }\n  } // Editor preview styling class.\n\n\n  if (!Object.prototype.hasOwnProperty.call(options, 'previewClass')) {\n    options.previewClass = 'editor-preview';\n  } // Handle status bar\n\n\n  if (!Object.prototype.hasOwnProperty.call(options, 'status')) {\n    options.status = ['autosave', 'lines', 'words', 'cursor'];\n\n    if (options.uploadImage) {\n      options.status.unshift('upload-image');\n    }\n  } // Add default preview rendering function\n\n\n  if (!options.previewRender) {\n    options.previewRender = function (plainText) {\n      // Note: \"this\" refers to the options object\n      return this.parent.markdown(plainText);\n    };\n  } // Set default options for parsing config\n\n\n  options.parsingConfig = extend({\n    highlightFormatting: true // needed for toggleCodeBlock to detect types of code\n\n  }, options.parsingConfig || {}); // Merging the insertTexts, with the given options\n\n  options.insertTexts = extend({}, insertTexts, options.insertTexts || {}); // Merging the promptTexts, with the given options\n\n  options.promptTexts = extend({}, promptTexts, options.promptTexts || {}); // Merging the blockStyles, with the given options\n\n  options.blockStyles = extend({}, blockStyles, options.blockStyles || {});\n\n  if (options.autosave != undefined) {\n    // Merging the Autosave timeFormat, with the given options\n    options.autosave.timeFormat = extend({}, timeFormat, options.autosave.timeFormat || {});\n  } // Merging the shortcuts, with the given options\n\n\n  options.shortcuts = extend({}, shortcuts, options.shortcuts || {});\n  options.maxHeight = options.maxHeight || undefined;\n  options.direction = options.direction || 'ltr';\n\n  if (typeof options.maxHeight !== 'undefined') {\n    // Min and max height are equal if maxHeight is set\n    options.minHeight = options.maxHeight;\n  } else {\n    options.minHeight = options.minHeight || '300px';\n  }\n\n  options.errorCallback = options.errorCallback || function (errorMessage) {\n    alert(errorMessage);\n  }; // Import-image default configuration\n\n\n  options.uploadImage = options.uploadImage || false;\n  options.imageMaxSize = options.imageMaxSize || 2097152; // 1024 * 1024 * 2\n\n  options.imageAccept = options.imageAccept || 'image/png, image/jpeg';\n  options.imageTexts = extend({}, imageTexts, options.imageTexts || {});\n  options.errorMessages = extend({}, errorMessages, options.errorMessages || {}); // Change unique_id to uniqueId for backwards compatibility\n\n  if (options.autosave != undefined && options.autosave.unique_id != undefined && options.autosave.unique_id != '') options.autosave.uniqueId = options.autosave.unique_id; // If overlay mode is specified and combine is not provided, default it to true\n\n  if (options.overlayMode && options.overlayMode.combine === undefined) {\n    options.overlayMode.combine = true;\n  } // Update this options\n\n\n  this.options = options; // Auto render\n\n  this.render(); // The codemirror component is only available after rendering\n  // so, the setter for the initialValue can only run after\n  // the element has been rendered\n\n  if (options.initialValue && (!this.options.autosave || this.options.autosave.foundSavedValue !== true)) {\n    this.value(options.initialValue);\n  }\n\n  if (options.uploadImage) {\n    var self = this;\n    this.codemirror.on('dragenter', function (cm, event) {\n      self.updateStatusBar('upload-image', self.options.imageTexts.sbOnDragEnter);\n      event.stopPropagation();\n      event.preventDefault();\n    });\n    this.codemirror.on('dragend', function (cm, event) {\n      self.updateStatusBar('upload-image', self.options.imageTexts.sbInit);\n      event.stopPropagation();\n      event.preventDefault();\n    });\n    this.codemirror.on('dragleave', function (cm, event) {\n      self.updateStatusBar('upload-image', self.options.imageTexts.sbInit);\n      event.stopPropagation();\n      event.preventDefault();\n    });\n    this.codemirror.on('dragover', function (cm, event) {\n      self.updateStatusBar('upload-image', self.options.imageTexts.sbOnDragEnter);\n      event.stopPropagation();\n      event.preventDefault();\n    });\n    this.codemirror.on('drop', function (cm, event) {\n      event.stopPropagation();\n      event.preventDefault();\n\n      if (options.imageUploadFunction) {\n        self.uploadImagesUsingCustomFunction(options.imageUploadFunction, event.dataTransfer.files);\n      } else {\n        self.uploadImages(event.dataTransfer.files);\n      }\n    });\n    this.codemirror.on('paste', function (cm, event) {\n      if (options.imageUploadFunction) {\n        self.uploadImagesUsingCustomFunction(options.imageUploadFunction, event.clipboardData.files);\n      } else {\n        self.uploadImages(event.clipboardData.files);\n      }\n    });\n  }\n}\n/**\n * Upload asynchronously a list of images to a server.\n *\n * Can be triggered by:\n * - drag&drop;\n * - copy-paste;\n * - the browse-file window (opened when the user clicks on the *upload-image* icon).\n * @param {FileList} files The files to upload the the server.\n * @param [onSuccess] {function} see EasyMDE.prototype.uploadImage\n * @param [onError] {function} see EasyMDE.prototype.uploadImage\n */\n\n\nEasyMDE.prototype.uploadImages = function (files, onSuccess, onError) {\n  if (files.length === 0) {\n    return;\n  }\n\n  var names = [];\n\n  for (var i = 0; i < files.length; i++) {\n    names.push(files[i].name);\n    this.uploadImage(files[i], onSuccess, onError);\n  }\n\n  this.updateStatusBar('upload-image', this.options.imageTexts.sbOnDrop.replace('#images_names#', names.join(', ')));\n};\n/**\n * Upload asynchronously a list of images to a server.\n *\n * Can be triggered by:\n * - drag&drop;\n * - copy-paste;\n * - the browse-file window (opened when the user clicks on the *upload-image* icon).\n * @param imageUploadFunction {Function} The custom function to upload the image passed in options.\n * @param {FileList} files The files to upload the the server.\n */\n\n\nEasyMDE.prototype.uploadImagesUsingCustomFunction = function (imageUploadFunction, files) {\n  if (files.length === 0) {\n    return;\n  }\n\n  var names = [];\n\n  for (var i = 0; i < files.length; i++) {\n    names.push(files[i].name);\n    this.uploadImageUsingCustomFunction(imageUploadFunction, files[i]);\n  }\n\n  this.updateStatusBar('upload-image', this.options.imageTexts.sbOnDrop.replace('#images_names#', names.join(', ')));\n};\n/**\n * Update an item in the status bar.\n * @param itemName {string} The name of the item to update (ie. 'upload-image', 'autosave', etc.).\n * @param content {string} the new content of the item to write in the status bar.\n */\n\n\nEasyMDE.prototype.updateStatusBar = function (itemName, content) {\n  if (!this.gui.statusbar) {\n    return;\n  }\n\n  var matchingClasses = this.gui.statusbar.getElementsByClassName(itemName);\n\n  if (matchingClasses.length === 1) {\n    this.gui.statusbar.getElementsByClassName(itemName)[0].textContent = content;\n  } else if (matchingClasses.length === 0) {\n    console.log('EasyMDE: status bar item ' + itemName + ' was not found.');\n  } else {\n    console.log('EasyMDE: Several status bar items named ' + itemName + ' was found.');\n  }\n};\n/**\n * Default markdown render.\n */\n\n\nEasyMDE.prototype.markdown = function (text) {\n  if (marked) {\n    // Initialize\n    var markedOptions;\n\n    if (this.options && this.options.renderingConfig && this.options.renderingConfig.markedOptions) {\n      markedOptions = this.options.renderingConfig.markedOptions;\n    } else {\n      markedOptions = {};\n    } // Update options\n\n\n    if (this.options && this.options.renderingConfig && this.options.renderingConfig.singleLineBreaks === false) {\n      markedOptions.breaks = false;\n    } else {\n      markedOptions.breaks = true;\n    }\n\n    if (this.options && this.options.renderingConfig && this.options.renderingConfig.codeSyntaxHighlighting === true) {\n      /* Get HLJS from config or window */\n      var hljs = this.options.renderingConfig.hljs || window.hljs;\n      /* Check if HLJS loaded */\n\n      if (hljs) {\n        markedOptions.highlight = function (code, language) {\n          if (language && hljs.getLanguage(language)) {\n            return hljs.highlight(language, code).value;\n          } else {\n            return hljs.highlightAuto(code).value;\n          }\n        };\n      }\n    } // Set options\n\n\n    marked.setOptions(markedOptions); // Convert the markdown to HTML\n\n    var htmlText = marked.parse(text); // Sanitize HTML\n\n    if (this.options.renderingConfig && typeof this.options.renderingConfig.sanitizerFunction === 'function') {\n      htmlText = this.options.renderingConfig.sanitizerFunction.call(this, htmlText);\n    } // Edit the HTML anchors to add 'target=\"_blank\"' by default.\n\n\n    htmlText = addAnchorTargetBlank(htmlText); // Remove list-style when rendering checkboxes\n\n    htmlText = removeListStyleWhenCheckbox(htmlText);\n    return htmlText;\n  }\n};\n/**\n * Render editor to the given element.\n */\n\n\nEasyMDE.prototype.render = function (el) {\n  if (!el) {\n    el = this.element || document.getElementsByTagName('textarea')[0];\n  }\n\n  if (this._rendered && this._rendered === el) {\n    // Already rendered.\n    return;\n  }\n\n  this.element = el;\n  var options = this.options;\n  var self = this;\n  var keyMaps = {};\n\n  for (var key in options.shortcuts) {\n    // null stands for \"do not bind this command\"\n    if (options.shortcuts[key] !== null && bindings[key] !== null) {\n      (function (key) {\n        keyMaps[fixShortcut(options.shortcuts[key])] = function () {\n          var action = bindings[key];\n\n          if (typeof action === 'function') {\n            action(self);\n          } else if (typeof action === 'string') {\n            window.open(action, '_blank');\n          }\n        };\n      })(key);\n    }\n  }\n\n  keyMaps['Enter'] = 'newlineAndIndentContinueMarkdownList';\n  keyMaps['Tab'] = 'tabAndIndentMarkdownList';\n  keyMaps['Shift-Tab'] = 'shiftTabAndUnindentMarkdownList';\n\n  keyMaps['Esc'] = function (cm) {\n    if (cm.getOption('fullScreen')) toggleFullScreen(self);\n  };\n\n  this.documentOnKeyDown = function (e) {\n    e = e || window.event;\n\n    if (e.keyCode == 27) {\n      if (self.codemirror.getOption('fullScreen')) toggleFullScreen(self);\n    }\n  };\n\n  document.addEventListener('keydown', this.documentOnKeyDown, false);\n  var mode, backdrop; // CodeMirror overlay mode\n\n  if (options.overlayMode) {\n    CodeMirror.defineMode('overlay-mode', function (config) {\n      return CodeMirror.overlayMode(CodeMirror.getMode(config, options.spellChecker !== false ? 'spell-checker' : 'gfm'), options.overlayMode.mode, options.overlayMode.combine);\n    });\n    mode = 'overlay-mode';\n    backdrop = options.parsingConfig;\n    backdrop.gitHubSpice = false;\n  } else {\n    mode = options.parsingConfig;\n    mode.name = 'gfm';\n    mode.gitHubSpice = false;\n  }\n\n  if (options.spellChecker !== false) {\n    mode = 'spell-checker';\n    backdrop = options.parsingConfig;\n    backdrop.name = 'gfm';\n    backdrop.gitHubSpice = false;\n\n    if (typeof options.spellChecker === 'function') {\n      options.spellChecker({\n        codeMirrorInstance: CodeMirror\n      });\n    } else {\n      CodeMirrorSpellChecker({\n        codeMirrorInstance: CodeMirror\n      });\n    }\n  } // eslint-disable-next-line no-unused-vars\n\n\n  function configureMouse(cm, repeat, event) {\n    return {\n      addNew: false\n    };\n  }\n\n  this.codemirror = CodeMirror.fromTextArea(el, {\n    mode: mode,\n    backdrop: backdrop,\n    theme: options.theme != undefined ? options.theme : 'easymde',\n    tabSize: options.tabSize != undefined ? options.tabSize : 2,\n    indentUnit: options.tabSize != undefined ? options.tabSize : 2,\n    indentWithTabs: options.indentWithTabs === false ? false : true,\n    lineNumbers: options.lineNumbers === true ? true : false,\n    autofocus: options.autofocus === true ? true : false,\n    extraKeys: keyMaps,\n    direction: options.direction,\n    lineWrapping: options.lineWrapping === false ? false : true,\n    allowDropFileTypes: ['text/plain'],\n    placeholder: options.placeholder || el.getAttribute('placeholder') || '',\n    styleSelectedText: options.styleSelectedText != undefined ? options.styleSelectedText : !isMobile(),\n    scrollbarStyle: options.scrollbarStyle != undefined ? options.scrollbarStyle : 'native',\n    configureMouse: configureMouse,\n    inputStyle: options.inputStyle != undefined ? options.inputStyle : isMobile() ? 'contenteditable' : 'textarea',\n    spellcheck: options.nativeSpellcheck != undefined ? options.nativeSpellcheck : true,\n    autoRefresh: options.autoRefresh != undefined ? options.autoRefresh : false\n  });\n  this.codemirror.getScrollerElement().style.minHeight = options.minHeight;\n\n  if (typeof options.maxHeight !== 'undefined') {\n    this.codemirror.getScrollerElement().style.height = options.maxHeight;\n  }\n\n  if (options.forceSync === true) {\n    var cm = this.codemirror;\n    cm.on('change', function () {\n      cm.save();\n    });\n  }\n\n  this.gui = {}; // Wrap Codemirror with container before create toolbar, etc,\n  // to use with sideBySideFullscreen option.\n\n  var easyMDEContainer = document.createElement('div');\n  easyMDEContainer.classList.add('EasyMDEContainer');\n  var cmWrapper = this.codemirror.getWrapperElement();\n  cmWrapper.parentNode.insertBefore(easyMDEContainer, cmWrapper);\n  easyMDEContainer.appendChild(cmWrapper);\n\n  if (options.toolbar !== false) {\n    this.gui.toolbar = this.createToolbar();\n  }\n\n  if (options.status !== false) {\n    this.gui.statusbar = this.createStatusbar();\n  }\n\n  if (options.autosave != undefined && options.autosave.enabled === true) {\n    this.autosave(); // use to load localstorage content\n\n    this.codemirror.on('change', function () {\n      clearTimeout(self._autosave_timeout);\n      self._autosave_timeout = setTimeout(function () {\n        self.autosave();\n      }, self.options.autosave.submit_delay || self.options.autosave.delay || 1000);\n    });\n  }\n\n  function calcHeight(naturalWidth, naturalHeight) {\n    var height;\n    var viewportWidth = window.getComputedStyle(document.querySelector('.CodeMirror-sizer')).width.replace('px', '');\n\n    if (naturalWidth < viewportWidth) {\n      height = naturalHeight + 'px';\n    } else {\n      height = naturalHeight / naturalWidth * 100 + '%';\n    }\n\n    return height;\n  }\n\n  var _vm = this;\n\n  function assignImageBlockAttributes(parentEl, img) {\n    parentEl.setAttribute('data-img-src', img.url);\n    parentEl.setAttribute('style', '--bg-image:url(' + img.url + ');--width:' + img.naturalWidth + 'px;--height:' + calcHeight(img.naturalWidth, img.naturalHeight));\n\n    _vm.codemirror.setSize();\n  }\n\n  function handleImages() {\n    if (!options.previewImagesInEditor) {\n      return;\n    }\n\n    easyMDEContainer.querySelectorAll('.cm-image-marker').forEach(function (e) {\n      var parentEl = e.parentElement;\n\n      if (!parentEl.innerText.match(/^!\\[.*?\\]\\(.*\\)/g)) {\n        // if img pasted on the same line with other text, don't preview, preview only images on separate line\n        return;\n      }\n\n      if (!parentEl.hasAttribute('data-img-src')) {\n        var srcAttr = parentEl.innerText.match('\\\\((.*)\\\\)'); // might require better parsing according to markdown spec\n\n        if (!window.EMDEimagesCache) {\n          window.EMDEimagesCache = {};\n        }\n\n        if (srcAttr && srcAttr.length >= 2) {\n          var keySrc = srcAttr[1];\n\n          if (!window.EMDEimagesCache[keySrc]) {\n            var img = document.createElement('img');\n\n            img.onload = function () {\n              window.EMDEimagesCache[keySrc] = {\n                naturalWidth: img.naturalWidth,\n                naturalHeight: img.naturalHeight,\n                url: keySrc\n              };\n              assignImageBlockAttributes(parentEl, window.EMDEimagesCache[keySrc]);\n            };\n\n            img.src = keySrc;\n          } else {\n            assignImageBlockAttributes(parentEl, window.EMDEimagesCache[keySrc]);\n          }\n        }\n      }\n    });\n  }\n\n  this.codemirror.on('update', function () {\n    handleImages();\n  });\n  this.gui.sideBySide = this.createSideBySide();\n  this._rendered = this.element; // Fixes CodeMirror bug (#344)\n\n  var temp_cm = this.codemirror;\n  setTimeout(function () {\n    temp_cm.refresh();\n  }.bind(temp_cm), 0);\n};\n\nEasyMDE.prototype.cleanup = function () {\n  document.removeEventListener('keydown', this.documentOnKeyDown);\n}; // Safari, in Private Browsing Mode, looks like it supports localStorage but all calls to setItem throw QuotaExceededError. We're going to detect this and set a variable accordingly.\n\n\nfunction isLocalStorageAvailable() {\n  if (typeof localStorage === 'object') {\n    try {\n      localStorage.setItem('smde_localStorage', 1);\n      localStorage.removeItem('smde_localStorage');\n    } catch (e) {\n      return false;\n    }\n  } else {\n    return false;\n  }\n\n  return true;\n}\n\nEasyMDE.prototype.autosave = function () {\n  if (isLocalStorageAvailable()) {\n    var easyMDE = this;\n\n    if (this.options.autosave.uniqueId == undefined || this.options.autosave.uniqueId == '') {\n      console.log('EasyMDE: You must set a uniqueId to use the autosave feature');\n      return;\n    }\n\n    if (this.options.autosave.binded !== true) {\n      if (easyMDE.element.form != null && easyMDE.element.form != undefined) {\n        easyMDE.element.form.addEventListener('submit', function () {\n          clearTimeout(easyMDE.autosaveTimeoutId);\n          easyMDE.autosaveTimeoutId = undefined;\n          localStorage.removeItem('smde_' + easyMDE.options.autosave.uniqueId);\n        });\n      }\n\n      this.options.autosave.binded = true;\n    }\n\n    if (this.options.autosave.loaded !== true) {\n      if (typeof localStorage.getItem('smde_' + this.options.autosave.uniqueId) == 'string' && localStorage.getItem('smde_' + this.options.autosave.uniqueId) != '') {\n        this.codemirror.setValue(localStorage.getItem('smde_' + this.options.autosave.uniqueId));\n        this.options.autosave.foundSavedValue = true;\n      }\n\n      this.options.autosave.loaded = true;\n    }\n\n    var value = easyMDE.value();\n\n    if (value !== '') {\n      localStorage.setItem('smde_' + this.options.autosave.uniqueId, value);\n    } else {\n      localStorage.removeItem('smde_' + this.options.autosave.uniqueId);\n    }\n\n    var el = document.getElementById('autosaved');\n\n    if (el != null && el != undefined && el != '') {\n      var d = new Date();\n      var dd = new Intl.DateTimeFormat([this.options.autosave.timeFormat.locale, 'en-US'], this.options.autosave.timeFormat.format).format(d);\n      var save = this.options.autosave.text == undefined ? 'Autosaved: ' : this.options.autosave.text;\n      el.innerHTML = save + dd;\n    }\n  } else {\n    console.log('EasyMDE: localStorage not available, cannot autosave');\n  }\n};\n\nEasyMDE.prototype.clearAutosavedValue = function () {\n  if (isLocalStorageAvailable()) {\n    if (this.options.autosave == undefined || this.options.autosave.uniqueId == undefined || this.options.autosave.uniqueId == '') {\n      console.log('EasyMDE: You must set a uniqueId to clear the autosave value');\n      return;\n    }\n\n    localStorage.removeItem('smde_' + this.options.autosave.uniqueId);\n  } else {\n    console.log('EasyMDE: localStorage not available, cannot autosave');\n  }\n};\n/**\n * Open the browse-file window to upload an image to a server.\n * @param [onSuccess] {function} see EasyMDE.prototype.uploadImage\n * @param [onError] {function} see EasyMDE.prototype.uploadImage\n */\n\n\nEasyMDE.prototype.openBrowseFileWindow = function (onSuccess, onError) {\n  var self = this;\n  var imageInput = this.gui.toolbar.getElementsByClassName('imageInput')[0];\n  imageInput.click(); //dispatchEvent(new MouseEvent('click'));  // replaced with click() for IE11 compatibility.\n\n  function onChange(event) {\n    if (self.options.imageUploadFunction) {\n      self.uploadImagesUsingCustomFunction(self.options.imageUploadFunction, event.target.files);\n    } else {\n      self.uploadImages(event.target.files, onSuccess, onError);\n    }\n\n    imageInput.removeEventListener('change', onChange);\n  }\n\n  imageInput.addEventListener('change', onChange);\n};\n/**\n * Upload an image to the server.\n *\n * @param file {File} The image to upload, as a HTML5 File object (https://developer.mozilla.org/en-US/docs/Web/API/File)\n * @param [onSuccess] {function} A callback function to execute after the image has been successfully uploaded, with one parameter:\n * - url (string): The URL of the uploaded image.\n * @param [onError] {function} A callback function to execute when the image upload fails, with one parameter:\n * - error (string): the detailed error to display to the user (based on messages from options.errorMessages).\n */\n\n\nEasyMDE.prototype.uploadImage = function (file, onSuccess, onError) {\n  var self = this;\n\n  onSuccess = onSuccess || function onSuccess(imageUrl) {\n    afterImageUploaded(self, imageUrl);\n  };\n\n  function onErrorSup(errorMessage) {\n    // show error on status bar and reset after 10000ms\n    self.updateStatusBar('upload-image', errorMessage);\n    setTimeout(function () {\n      self.updateStatusBar('upload-image', self.options.imageTexts.sbInit);\n    }, 10000); // run custom error handler\n\n    if (onError && typeof onError === 'function') {\n      onError(errorMessage);\n    } // run error handler from options, this alerts the message.\n\n\n    self.options.errorCallback(errorMessage);\n  }\n\n  function fillErrorMessage(errorMessage) {\n    var units = self.options.imageTexts.sizeUnits.split(',');\n    return errorMessage.replace('#image_name#', file.name).replace('#image_size#', humanFileSize(file.size, units)).replace('#image_max_size#', humanFileSize(self.options.imageMaxSize, units));\n  }\n\n  if (file.size > this.options.imageMaxSize) {\n    onErrorSup(fillErrorMessage(this.options.errorMessages.fileTooLarge));\n    return;\n  }\n\n  var formData = new FormData();\n  formData.append('image', file); // insert CSRF token if provided in config.\n\n  if (self.options.imageCSRFToken) {\n    formData.append('csrfmiddlewaretoken', self.options.imageCSRFToken);\n  }\n\n  var request = new XMLHttpRequest();\n\n  request.upload.onprogress = function (event) {\n    if (event.lengthComputable) {\n      var progress = '' + Math.round(event.loaded * 100 / event.total);\n      self.updateStatusBar('upload-image', self.options.imageTexts.sbProgress.replace('#file_name#', file.name).replace('#progress#', progress));\n    }\n  };\n\n  request.open('POST', this.options.imageUploadEndpoint);\n\n  request.onload = function () {\n    try {\n      var response = JSON.parse(this.responseText);\n    } catch (error) {\n      console.error('EasyMDE: The server did not return a valid json.');\n      onErrorSup(fillErrorMessage(self.options.errorMessages.importError));\n      return;\n    }\n\n    if (this.status === 200 && response && !response.error && response.data && response.data.filePath) {\n      onSuccess((self.options.imagePathAbsolute ? '' : window.location.origin + '/') + response.data.filePath);\n    } else {\n      if (response.error && response.error in self.options.errorMessages) {\n        // preformatted error message\n        onErrorSup(fillErrorMessage(self.options.errorMessages[response.error]));\n      } else if (response.error) {\n        // server side generated error message\n        onErrorSup(fillErrorMessage(response.error));\n      } else {\n        //unknown error\n        console.error('EasyMDE: Received an unexpected response after uploading the image.' + this.status + ' (' + this.statusText + ')');\n        onErrorSup(fillErrorMessage(self.options.errorMessages.importError));\n      }\n    }\n  };\n\n  request.onerror = function (event) {\n    console.error('EasyMDE: An unexpected error occurred when trying to upload the image.' + event.target.status + ' (' + event.target.statusText + ')');\n    onErrorSup(self.options.errorMessages.importError);\n  };\n\n  request.send(formData);\n};\n/**\n * Upload an image to the server using a custom upload function.\n *\n * @param imageUploadFunction {Function} The custom function to upload the image passed in options\n * @param file {File} The image to upload, as a HTML5 File object (https://developer.mozilla.org/en-US/docs/Web/API/File).\n */\n\n\nEasyMDE.prototype.uploadImageUsingCustomFunction = function (imageUploadFunction, file) {\n  var self = this;\n\n  function onSuccess(imageUrl) {\n    afterImageUploaded(self, imageUrl);\n  }\n\n  function onError(errorMessage) {\n    var filledErrorMessage = fillErrorMessage(errorMessage); // show error on status bar and reset after 10000ms\n\n    self.updateStatusBar('upload-image', filledErrorMessage);\n    setTimeout(function () {\n      self.updateStatusBar('upload-image', self.options.imageTexts.sbInit);\n    }, 10000); // run error handler from options, this alerts the message.\n\n    self.options.errorCallback(filledErrorMessage);\n  }\n\n  function fillErrorMessage(errorMessage) {\n    var units = self.options.imageTexts.sizeUnits.split(',');\n    return errorMessage.replace('#image_name#', file.name).replace('#image_size#', humanFileSize(file.size, units)).replace('#image_max_size#', humanFileSize(self.options.imageMaxSize, units));\n  }\n\n  imageUploadFunction.apply(this, [file, onSuccess, onError]);\n};\n\nEasyMDE.prototype.setPreviewMaxHeight = function () {\n  var cm = this.codemirror;\n  var wrapper = cm.getWrapperElement();\n  var preview = wrapper.nextSibling; // Calc preview max height\n\n  var paddingTop = parseInt(window.getComputedStyle(wrapper).paddingTop);\n  var borderTopWidth = parseInt(window.getComputedStyle(wrapper).borderTopWidth);\n  var optionsMaxHeight = parseInt(this.options.maxHeight);\n  var wrapperMaxHeight = optionsMaxHeight + paddingTop * 2 + borderTopWidth * 2;\n  var previewMaxHeight = wrapperMaxHeight.toString() + 'px';\n  preview.style.height = previewMaxHeight;\n};\n\nEasyMDE.prototype.createSideBySide = function () {\n  var cm = this.codemirror;\n  var wrapper = cm.getWrapperElement();\n  var preview = wrapper.nextSibling;\n\n  if (!preview || !/editor-preview-side/.test(preview.className)) {\n    preview = document.createElement('div');\n    preview.className = 'editor-preview-side';\n\n    if (this.options.previewClass) {\n      if (Array.isArray(this.options.previewClass)) {\n        for (var i = 0; i < this.options.previewClass.length; i++) {\n          preview.className += ' ' + this.options.previewClass[i];\n        }\n      } else if (typeof this.options.previewClass === 'string') {\n        preview.className += ' ' + this.options.previewClass;\n      }\n    }\n\n    wrapper.parentNode.insertBefore(preview, wrapper.nextSibling);\n  }\n\n  if (typeof this.options.maxHeight !== 'undefined') {\n    this.setPreviewMaxHeight();\n  }\n\n  if (this.options.syncSideBySidePreviewScroll === false) return preview; // Syncs scroll  editor -> preview\n\n  var cScroll = false;\n  var pScroll = false;\n  cm.on('scroll', function (v) {\n    if (cScroll) {\n      cScroll = false;\n      return;\n    }\n\n    pScroll = true;\n    var height = v.getScrollInfo().height - v.getScrollInfo().clientHeight;\n    var ratio = parseFloat(v.getScrollInfo().top) / height;\n    var move = (preview.scrollHeight - preview.clientHeight) * ratio;\n    preview.scrollTop = move;\n  }); // Syncs scroll  preview -> editor\n\n  preview.onscroll = function () {\n    if (pScroll) {\n      pScroll = false;\n      return;\n    }\n\n    cScroll = true;\n    var height = preview.scrollHeight - preview.clientHeight;\n    var ratio = parseFloat(preview.scrollTop) / height;\n    var move = (cm.getScrollInfo().height - cm.getScrollInfo().clientHeight) * ratio;\n    cm.scrollTo(0, move);\n  };\n\n  return preview;\n};\n\nEasyMDE.prototype.createToolbar = function (items) {\n  items = items || this.options.toolbar;\n\n  if (!items || items.length === 0) {\n    return;\n  }\n\n  var i;\n\n  for (i = 0; i < items.length; i++) {\n    if (toolbarBuiltInButtons[items[i]] != undefined) {\n      items[i] = toolbarBuiltInButtons[items[i]];\n    }\n  }\n\n  var bar = document.createElement('div');\n  bar.className = 'editor-toolbar';\n  var self = this;\n  var toolbarData = {};\n  self.toolbar = items;\n\n  for (i = 0; i < items.length; i++) {\n    if (items[i].name == 'guide' && self.options.toolbarGuideIcon === false) continue;\n    if (self.options.hideIcons && self.options.hideIcons.indexOf(items[i].name) != -1) continue; // Fullscreen does not work well on mobile devices (even tablets)\n    // In the future, hopefully this can be resolved\n\n    if ((items[i].name == 'fullscreen' || items[i].name == 'side-by-side') && isMobile()) continue; // Don't include trailing separators\n\n    if (items[i] === '|') {\n      var nonSeparatorIconsFollow = false;\n\n      for (var x = i + 1; x < items.length; x++) {\n        if (items[x] !== '|' && (!self.options.hideIcons || self.options.hideIcons.indexOf(items[x].name) == -1)) {\n          nonSeparatorIconsFollow = true;\n        }\n      }\n\n      if (!nonSeparatorIconsFollow) continue;\n    } // Create the icon and append to the toolbar\n\n\n    (function (item) {\n      var el;\n\n      if (item === '|') {\n        el = createSep();\n      } else if (item.children) {\n        el = createToolbarDropdown(item, self.options.toolbarTips, self.options.shortcuts, self);\n      } else {\n        el = createToolbarButton(item, true, self.options.toolbarTips, self.options.shortcuts, 'button', self);\n      }\n\n      toolbarData[item.name || item] = el;\n      bar.appendChild(el); // Create the input element (ie. <input type='file'>), used among\n      // with the 'import-image' icon to open the browse-file window.\n\n      if (item.name === 'upload-image') {\n        var imageInput = document.createElement('input');\n        imageInput.className = 'imageInput';\n        imageInput.type = 'file';\n        imageInput.multiple = true;\n        imageInput.name = 'image';\n        imageInput.accept = self.options.imageAccept;\n        imageInput.style.display = 'none';\n        imageInput.style.opacity = 0;\n        bar.appendChild(imageInput);\n      }\n    })(items[i]);\n  }\n\n  self.toolbar_div = bar;\n  self.toolbarElements = toolbarData;\n  var cm = this.codemirror;\n  cm.on('cursorActivity', function () {\n    var stat = getState(cm);\n\n    for (var key in toolbarData) {\n      (function (key) {\n        var el = toolbarData[key];\n\n        if (stat[key]) {\n          el.className += ' active';\n        } else if (key != 'fullscreen' && key != 'side-by-side') {\n          el.className = el.className.replace(/\\s*active\\s*/g, '');\n        }\n      })(key);\n    }\n  });\n  var cmWrapper = cm.getWrapperElement();\n  cmWrapper.parentNode.insertBefore(bar, cmWrapper);\n  return bar;\n};\n\nEasyMDE.prototype.createStatusbar = function (status) {\n  // Initialize\n  status = status || this.options.status;\n  var options = this.options;\n  var cm = this.codemirror; // Make sure the status variable is valid\n\n  if (!status || status.length === 0) {\n    return;\n  } // Set up the built-in items\n\n\n  var items = [];\n  var i, onUpdate, onActivity, defaultValue;\n\n  for (i = 0; i < status.length; i++) {\n    // Reset some values\n    onUpdate = undefined;\n    onActivity = undefined;\n    defaultValue = undefined; // Handle if custom or not\n\n    if (typeof status[i] === 'object') {\n      items.push({\n        className: status[i].className,\n        defaultValue: status[i].defaultValue,\n        onUpdate: status[i].onUpdate,\n        onActivity: status[i].onActivity\n      });\n    } else {\n      var name = status[i];\n\n      if (name === 'words') {\n        defaultValue = function (el) {\n          el.innerHTML = wordCount(cm.getValue());\n        };\n\n        onUpdate = function (el) {\n          el.innerHTML = wordCount(cm.getValue());\n        };\n      } else if (name === 'lines') {\n        defaultValue = function (el) {\n          el.innerHTML = cm.lineCount();\n        };\n\n        onUpdate = function (el) {\n          el.innerHTML = cm.lineCount();\n        };\n      } else if (name === 'cursor') {\n        defaultValue = function (el) {\n          el.innerHTML = '1:1';\n        };\n\n        onActivity = function (el) {\n          var pos = cm.getCursor();\n          var posLine = pos.line + 1;\n          var posColumn = pos.ch + 1;\n          el.innerHTML = posLine + ':' + posColumn;\n        };\n      } else if (name === 'autosave') {\n        defaultValue = function (el) {\n          if (options.autosave != undefined && options.autosave.enabled === true) {\n            el.setAttribute('id', 'autosaved');\n          }\n        };\n      } else if (name === 'upload-image') {\n        defaultValue = function (el) {\n          el.innerHTML = options.imageTexts.sbInit;\n        };\n      }\n\n      items.push({\n        className: name,\n        defaultValue: defaultValue,\n        onUpdate: onUpdate,\n        onActivity: onActivity\n      });\n    }\n  } // Create element for the status bar\n\n\n  var bar = document.createElement('div');\n  bar.className = 'editor-statusbar'; // Create a new span for each item\n\n  for (i = 0; i < items.length; i++) {\n    // Store in temporary variable\n    var item = items[i]; // Create span element\n\n    var el = document.createElement('span');\n    el.className = item.className; // Ensure the defaultValue is a function\n\n    if (typeof item.defaultValue === 'function') {\n      item.defaultValue(el);\n    } // Ensure the onUpdate is a function\n\n\n    if (typeof item.onUpdate === 'function') {\n      // Create a closure around the span of the current action, then execute the onUpdate handler\n      this.codemirror.on('update', function (el, item) {\n        return function () {\n          item.onUpdate(el);\n        };\n      }(el, item));\n    }\n\n    if (typeof item.onActivity === 'function') {\n      // Create a closure around the span of the current action, then execute the onActivity handler\n      this.codemirror.on('cursorActivity', function (el, item) {\n        return function () {\n          item.onActivity(el);\n        };\n      }(el, item));\n    } // Append the item to the status bar\n\n\n    bar.appendChild(el);\n  } // Insert the status bar into the DOM\n\n\n  var cmWrapper = this.codemirror.getWrapperElement();\n  cmWrapper.parentNode.insertBefore(bar, cmWrapper.nextSibling);\n  return bar;\n};\n/**\n * Get or set the text content.\n */\n\n\nEasyMDE.prototype.value = function (val) {\n  var cm = this.codemirror;\n\n  if (val === undefined) {\n    return cm.getValue();\n  } else {\n    cm.getDoc().setValue(val);\n\n    if (this.isPreviewActive()) {\n      var wrapper = cm.getWrapperElement();\n      var preview = wrapper.lastChild;\n      preview.innerHTML = this.options.previewRender(val, preview);\n    }\n\n    return this;\n  }\n};\n/**\n * Bind static methods for exports.\n */\n\n\nEasyMDE.toggleBold = toggleBold;\nEasyMDE.toggleItalic = toggleItalic;\nEasyMDE.toggleStrikethrough = toggleStrikethrough;\nEasyMDE.toggleBlockquote = toggleBlockquote;\nEasyMDE.toggleHeadingSmaller = toggleHeadingSmaller;\nEasyMDE.toggleHeadingBigger = toggleHeadingBigger;\nEasyMDE.toggleHeading1 = toggleHeading1;\nEasyMDE.toggleHeading2 = toggleHeading2;\nEasyMDE.toggleHeading3 = toggleHeading3;\nEasyMDE.toggleCodeBlock = toggleCodeBlock;\nEasyMDE.toggleUnorderedList = toggleUnorderedList;\nEasyMDE.toggleOrderedList = toggleOrderedList;\nEasyMDE.cleanBlock = cleanBlock;\nEasyMDE.drawLink = drawLink;\nEasyMDE.drawImage = drawImage;\nEasyMDE.drawUploadedImage = drawUploadedImage;\nEasyMDE.drawTable = drawTable;\nEasyMDE.drawHorizontalRule = drawHorizontalRule;\nEasyMDE.undo = undo;\nEasyMDE.redo = redo;\nEasyMDE.togglePreview = togglePreview;\nEasyMDE.toggleSideBySide = toggleSideBySide;\nEasyMDE.toggleFullScreen = toggleFullScreen;\n/**\n * Bind instance methods for exports.\n */\n\nEasyMDE.prototype.toggleBold = function () {\n  toggleBold(this);\n};\n\nEasyMDE.prototype.toggleItalic = function () {\n  toggleItalic(this);\n};\n\nEasyMDE.prototype.toggleStrikethrough = function () {\n  toggleStrikethrough(this);\n};\n\nEasyMDE.prototype.toggleBlockquote = function () {\n  toggleBlockquote(this);\n};\n\nEasyMDE.prototype.toggleHeadingSmaller = function () {\n  toggleHeadingSmaller(this);\n};\n\nEasyMDE.prototype.toggleHeadingBigger = function () {\n  toggleHeadingBigger(this);\n};\n\nEasyMDE.prototype.toggleHeading1 = function () {\n  toggleHeading1(this);\n};\n\nEasyMDE.prototype.toggleHeading2 = function () {\n  toggleHeading2(this);\n};\n\nEasyMDE.prototype.toggleHeading3 = function () {\n  toggleHeading3(this);\n};\n\nEasyMDE.prototype.toggleCodeBlock = function () {\n  toggleCodeBlock(this);\n};\n\nEasyMDE.prototype.toggleUnorderedList = function () {\n  toggleUnorderedList(this);\n};\n\nEasyMDE.prototype.toggleOrderedList = function () {\n  toggleOrderedList(this);\n};\n\nEasyMDE.prototype.cleanBlock = function () {\n  cleanBlock(this);\n};\n\nEasyMDE.prototype.drawLink = function () {\n  drawLink(this);\n};\n\nEasyMDE.prototype.drawImage = function () {\n  drawImage(this);\n};\n\nEasyMDE.prototype.drawUploadedImage = function () {\n  drawUploadedImage(this);\n};\n\nEasyMDE.prototype.drawTable = function () {\n  drawTable(this);\n};\n\nEasyMDE.prototype.drawHorizontalRule = function () {\n  drawHorizontalRule(this);\n};\n\nEasyMDE.prototype.undo = function () {\n  undo(this);\n};\n\nEasyMDE.prototype.redo = function () {\n  redo(this);\n};\n\nEasyMDE.prototype.togglePreview = function () {\n  togglePreview(this);\n};\n\nEasyMDE.prototype.toggleSideBySide = function () {\n  toggleSideBySide(this);\n};\n\nEasyMDE.prototype.toggleFullScreen = function () {\n  toggleFullScreen(this);\n};\n\nEasyMDE.prototype.isPreviewActive = function () {\n  var cm = this.codemirror;\n  var wrapper = cm.getWrapperElement();\n  var preview = wrapper.lastChild;\n  return /editor-preview-active/.test(preview.className);\n};\n\nEasyMDE.prototype.isSideBySideActive = function () {\n  var cm = this.codemirror;\n  var wrapper = cm.getWrapperElement();\n  var preview = wrapper.nextSibling;\n  return /editor-preview-active-side/.test(preview.className);\n};\n\nEasyMDE.prototype.isFullscreenActive = function () {\n  var cm = this.codemirror;\n  return cm.getOption('fullScreen');\n};\n\nEasyMDE.prototype.getState = function () {\n  var cm = this.codemirror;\n  return getState(cm);\n};\n\nEasyMDE.prototype.toTextArea = function () {\n  var cm = this.codemirror;\n  var wrapper = cm.getWrapperElement();\n  var easyMDEContainer = wrapper.parentNode;\n\n  if (easyMDEContainer) {\n    if (this.gui.toolbar) {\n      easyMDEContainer.removeChild(this.gui.toolbar);\n    }\n\n    if (this.gui.statusbar) {\n      easyMDEContainer.removeChild(this.gui.statusbar);\n    }\n\n    if (this.gui.sideBySide) {\n      easyMDEContainer.removeChild(this.gui.sideBySide);\n    }\n  } // Unwrap easyMDEcontainer before codemirror toTextArea() call\n\n\n  easyMDEContainer.parentNode.insertBefore(wrapper, easyMDEContainer);\n  easyMDEContainer.remove();\n  cm.toTextArea();\n\n  if (this.autosaveTimeoutId) {\n    clearTimeout(this.autosaveTimeoutId);\n    this.autosaveTimeoutId = undefined;\n    this.clearAutosavedValue();\n  }\n};\n\nmodule.exports = EasyMDE;","map":{"version":3,"names":["CodeMirror","require","CodeMirrorSpellChecker","marked","isMac","test","navigator","platform","anchorToExternalRegex","RegExp","bindings","toggleBold","toggleItalic","drawLink","toggleHeadingSmaller","toggleHeadingBigger","drawImage","toggleBlockquote","toggleOrderedList","toggleUnorderedList","toggleCodeBlock","togglePreview","toggleStrikethrough","toggleHeading1","toggleHeading2","toggleHeading3","cleanBlock","drawTable","drawHorizontalRule","undo","redo","toggleSideBySide","toggleFullScreen","shortcuts","getBindingName","f","key","isMobile","check","a","substr","userAgent","vendor","window","opera","addAnchorTargetBlank","htmlText","match","exec","linkString","indexOf","fixedLinkString","replace","removeListStyleWhenCheckbox","parser","DOMParser","htmlDoc","parseFromString","listItems","getElementsByTagName","i","length","listItem","j","children","listItemChild","HTMLInputElement","type","style","marginLeft","listStyleType","documentElement","innerHTML","fixShortcut","name","CLASS_REGEX","getClassRegex","className","addClass","el","classRegex","removeClass","createToolbarDropdown","options","enableTooltips","parent","createToolbarButton","onclick","focus","content","document","createElement","childrenIndex","child","childElement","toolbarBuiltInButtons","addEventListener","e","stopPropagation","appendChild","enableActions","markup","attributes","attribute","Object","prototype","hasOwnProperty","call","setAttribute","undefined","action","title","createTooltip","noDisable","classList","add","noMobile","classNameParts","split","iconClasses","classNameIndex","classNamePart","push","tabIndex","icon","iconClassIndex","iconClass","preventDefault","open","createSep","actionName","tooltip","getState","cm","pos","getCursor","stat","getTokenAt","types","ret","data","text","bold","getLine","line","quote","italic","strikethrough","code","link","image","saved_overflow","editor","codemirror","setOption","getOption","body","overflow","wrapper","getWrapperElement","sidebyside","nextSibling","sideBySideFullscreen","easyMDEContainer","parentNode","onToggleFullScreen","maxHeight","getScrollerElement","removeProperty","height","setPreviewMaxHeight","toolbar_div","toolbarElements","fullscreen","toolbarButton","_toggleBlock","blockStyles","fenceCharsToInsert","fencing_line","styles","token_state","token","state","base","code_type","line_num","firstTok","lastTok","getLineHandle","ch","indentedCode","fencedChars","insertFencingAtSelection","cur_start","cur_end","start_line_sel","end_line_sel","sel_multi","repl_start","repl_end","_replaceSelection","setSelection","tok","is_code","block_start","block_end","lineCount","start","slice","end","replaceRange","fencedTok","fence_chars","start_text","start_line","end_text","end_line","operation","search_from","next_line","next_line_last_tok","next_line_indented","indentLine","no_sel_and_starting_of_line","_toggleLine","_toggleHeading","listStyle","includes","unorderedListStyle","_cleanBlock","url","promptURLs","prompt","promptTexts","insertTexts","drawUploadedImage","openBrowseFileWindow","afterImageUploaded","imageName","lastIndexOf","ext","substring","toLowerCase","uploadedImage","text_link","updateStatusBar","imageTexts","sbOnUploaded","setTimeout","sbInit","table","horizontalRule","preview","useSideBySideListener","previewNormal","lastChild","toolbar","sideBySideRenderingFunction","newValue","previewRender","value","on","off","refresh","previewClass","Array","isArray","active","startEnd","startPoint","endPoint","assign","getSelection","replaceSelection","direction","size","currHeadingLevel","search","liststyle","listRegexp","whitespacesRegexp","repl","_getChar","map","_checkChar","char","rt","_toggle","untoggleOnly","arr","start_chars","end_chars","join","humanFileSize","bytes","units","Math","abs","u","toFixed","_mergeProperties","target","source","property","concat","constructor","extend","arguments","wordCount","pattern","m","count","charCodeAt","default","timeFormat","locale","format","hour","minute","sbOnDragEnter","sbOnDrop","sbProgress","sizeUnits","errorMessages","noFileGiven","typeNotAllowed","fileTooLarge","importError","EasyMDE","autoDownloadFA","autoDownloadFontAwesome","styleSheets","href","rel","element","console","log","showIcons","status","uploadImage","unshift","plainText","markdown","parsingConfig","highlightFormatting","autosave","minHeight","errorCallback","errorMessage","alert","imageMaxSize","imageAccept","unique_id","uniqueId","overlayMode","combine","render","initialValue","foundSavedValue","self","event","imageUploadFunction","uploadImagesUsingCustomFunction","dataTransfer","files","uploadImages","clipboardData","onSuccess","onError","names","uploadImageUsingCustomFunction","itemName","gui","statusbar","matchingClasses","getElementsByClassName","textContent","markedOptions","renderingConfig","singleLineBreaks","breaks","codeSyntaxHighlighting","hljs","highlight","language","getLanguage","highlightAuto","setOptions","parse","sanitizerFunction","_rendered","keyMaps","documentOnKeyDown","keyCode","mode","backdrop","defineMode","config","getMode","spellChecker","gitHubSpice","codeMirrorInstance","configureMouse","repeat","addNew","fromTextArea","theme","tabSize","indentUnit","indentWithTabs","lineNumbers","autofocus","extraKeys","lineWrapping","allowDropFileTypes","placeholder","getAttribute","styleSelectedText","scrollbarStyle","inputStyle","spellcheck","nativeSpellcheck","autoRefresh","forceSync","save","cmWrapper","insertBefore","createToolbar","createStatusbar","enabled","clearTimeout","_autosave_timeout","submit_delay","delay","calcHeight","naturalWidth","naturalHeight","viewportWidth","getComputedStyle","querySelector","width","_vm","assignImageBlockAttributes","parentEl","img","setSize","handleImages","previewImagesInEditor","querySelectorAll","forEach","parentElement","innerText","hasAttribute","srcAttr","EMDEimagesCache","keySrc","onload","src","sideBySide","createSideBySide","temp_cm","bind","cleanup","removeEventListener","isLocalStorageAvailable","localStorage","setItem","removeItem","easyMDE","binded","form","autosaveTimeoutId","loaded","getItem","setValue","getElementById","d","Date","dd","Intl","DateTimeFormat","clearAutosavedValue","imageInput","click","onChange","file","imageUrl","onErrorSup","fillErrorMessage","formData","FormData","append","imageCSRFToken","request","XMLHttpRequest","upload","onprogress","lengthComputable","progress","round","total","imageUploadEndpoint","response","JSON","responseText","error","filePath","imagePathAbsolute","location","origin","statusText","onerror","send","filledErrorMessage","apply","paddingTop","parseInt","borderTopWidth","optionsMaxHeight","wrapperMaxHeight","previewMaxHeight","toString","syncSideBySidePreviewScroll","cScroll","pScroll","v","getScrollInfo","clientHeight","ratio","parseFloat","top","move","scrollHeight","scrollTop","onscroll","scrollTo","items","bar","toolbarData","toolbarGuideIcon","hideIcons","nonSeparatorIconsFollow","x","item","toolbarTips","multiple","accept","display","opacity","onUpdate","onActivity","defaultValue","getValue","posLine","posColumn","val","getDoc","isPreviewActive","isSideBySideActive","isFullscreenActive","toTextArea","removeChild","remove","module","exports"],"sources":["C:/Users/Ernest/Desktop/mern-blog-frontend-master/node_modules/easymde/src/js/easymde.js"],"sourcesContent":["'use strict';\nvar CodeMirror = require('codemirror');\nrequire('codemirror/addon/edit/continuelist.js');\nrequire('./codemirror/tablist');\nrequire('codemirror/addon/display/fullscreen.js');\nrequire('codemirror/mode/markdown/markdown.js');\nrequire('codemirror/addon/mode/overlay.js');\nrequire('codemirror/addon/display/placeholder.js');\nrequire('codemirror/addon/display/autorefresh.js');\nrequire('codemirror/addon/selection/mark-selection.js');\nrequire('codemirror/addon/search/searchcursor.js');\nrequire('codemirror/mode/gfm/gfm.js');\nrequire('codemirror/mode/xml/xml.js');\nvar CodeMirrorSpellChecker = require('codemirror-spell-checker');\nvar marked = require('marked').marked;\n\n\n// Some variables\nvar isMac = /Mac/.test(navigator.platform);\nvar anchorToExternalRegex = new RegExp(/(<a.*?https?:\\/\\/.*?[^a]>)+?/g);\n\n// Mapping of actions that can be bound to keyboard shortcuts or toolbar buttons\nvar bindings = {\n    'toggleBold': toggleBold,\n    'toggleItalic': toggleItalic,\n    'drawLink': drawLink,\n    'toggleHeadingSmaller': toggleHeadingSmaller,\n    'toggleHeadingBigger': toggleHeadingBigger,\n    'drawImage': drawImage,\n    'toggleBlockquote': toggleBlockquote,\n    'toggleOrderedList': toggleOrderedList,\n    'toggleUnorderedList': toggleUnorderedList,\n    'toggleCodeBlock': toggleCodeBlock,\n    'togglePreview': togglePreview,\n    'toggleStrikethrough': toggleStrikethrough,\n    'toggleHeading1': toggleHeading1,\n    'toggleHeading2': toggleHeading2,\n    'toggleHeading3': toggleHeading3,\n    'cleanBlock': cleanBlock,\n    'drawTable': drawTable,\n    'drawHorizontalRule': drawHorizontalRule,\n    'undo': undo,\n    'redo': redo,\n    'toggleSideBySide': toggleSideBySide,\n    'toggleFullScreen': toggleFullScreen,\n};\n\nvar shortcuts = {\n    'toggleBold': 'Cmd-B',\n    'toggleItalic': 'Cmd-I',\n    'drawLink': 'Cmd-K',\n    'toggleHeadingSmaller': 'Cmd-H',\n    'toggleHeadingBigger': 'Shift-Cmd-H',\n    'cleanBlock': 'Cmd-E',\n    'drawImage': 'Cmd-Alt-I',\n    'toggleBlockquote': 'Cmd-\\'',\n    'toggleOrderedList': 'Cmd-Alt-L',\n    'toggleUnorderedList': 'Cmd-L',\n    'toggleCodeBlock': 'Cmd-Alt-C',\n    'togglePreview': 'Cmd-P',\n    'toggleSideBySide': 'F9',\n    'toggleFullScreen': 'F11',\n};\n\nvar getBindingName = function (f) {\n    for (var key in bindings) {\n        if (bindings[key] === f) {\n            return key;\n        }\n    }\n    return null;\n};\n\nvar isMobile = function () {\n    var check = false;\n    (function (a) {\n        if (/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(a.substr(0, 4))) check = true;\n    })(navigator.userAgent || navigator.vendor || window.opera);\n    return check;\n};\n\n/**\n * Modify HTML to add 'target=\"_blank\"' to links so they open in new tabs by default.\n * @param {string} htmlText - HTML to be modified.\n * @return {string} The modified HTML text.\n */\nfunction addAnchorTargetBlank(htmlText) {\n    var match;\n    while ((match = anchorToExternalRegex.exec(htmlText)) !== null) {\n        // With only one capture group in the RegExp, we can safely take the first index from the match.\n        var linkString = match[0];\n\n        if (linkString.indexOf('target=') === -1) {\n            var fixedLinkString = linkString.replace(/>$/, ' target=\"_blank\">');\n            htmlText = htmlText.replace(linkString, fixedLinkString);\n        }\n    }\n    return htmlText;\n}\n\n/**\n * Modify HTML to remove the list-style when rendering checkboxes.\n * @param {string} htmlText - HTML to be modified.\n * @return {string} The modified HTML text.\n */\nfunction removeListStyleWhenCheckbox(htmlText) {\n\n    var parser = new DOMParser();\n    var htmlDoc = parser.parseFromString(htmlText, 'text/html');\n    var listItems = htmlDoc.getElementsByTagName('li');\n\n    for (var i = 0; i < listItems.length; i++) {\n        var listItem = listItems[i];\n\n        for (var j = 0; j < listItem.children.length; j++) {\n            var listItemChild = listItem.children[j];\n\n            if (listItemChild instanceof HTMLInputElement && listItemChild.type === 'checkbox') {\n                // From Github: margin: 0 .2em .25em -1.6em;\n                listItem.style.marginLeft = '-1.5em';\n                listItem.style.listStyleType = 'none';\n            }\n        }\n    }\n\n    return htmlDoc.documentElement.innerHTML;\n}\n\n/**\n * Fix shortcut. Mac use Command, others use Ctrl.\n */\nfunction fixShortcut(name) {\n    if (isMac) {\n        name = name.replace('Ctrl', 'Cmd');\n    } else {\n        name = name.replace('Cmd', 'Ctrl');\n    }\n    return name;\n}\n\n/**\n * Class handling utility methods.\n */\nvar CLASS_REGEX = {};\n\n/**\n * Convert a className string into a regex for matching (and cache).\n * Note that the RegExp includes trailing spaces for replacement\n * (to ensure that removing a class from the middle of the string will retain\n *  spacing between other classes.)\n * @param {String} className Class name to convert to regex for matching.\n * @returns {RegExp} Regular expression option that will match className.\n */\nfunction getClassRegex(className) {\n    return CLASS_REGEX[className] || (CLASS_REGEX[className] = new RegExp('\\\\s*' + className + '(\\\\s*)', 'g'));\n}\n\n/**\n * Add a class string to an element.\n * @param {Element} el DOM element on which to add className.\n * @param {String} className Class string to apply\n * @returns {void}\n */\nfunction addClass(el, className) {\n    if (!el || !className) return;\n    var classRegex = getClassRegex(className);\n    if (el.className.match(classRegex)) return; // already applied\n    el.className += ' ' + className;\n}\n\n/**\n * Remove a class string from an element.\n * @param {Element} el DOM element from which to remove className.\n * @param {String} className Class string to remove\n * @returns {void}\n */\nfunction removeClass(el, className) {\n    if (!el || !className) return;\n    var classRegex = getClassRegex(className);\n    if (!el.className.match(classRegex)) return; // not available to remove\n    el.className = el.className.replace(classRegex, '$1');\n}\n\n\n/**\n * Create dropdown block\n */\nfunction createToolbarDropdown(options, enableTooltips, shortcuts, parent) {\n    var el = createToolbarButton(options, false, enableTooltips, shortcuts, 'button', parent);\n    el.className += ' easymde-dropdown';\n\n    el.onclick = function () {\n        el.focus();\n    };\n\n    var content = document.createElement('div');\n    content.className = 'easymde-dropdown-content';\n    for (var childrenIndex = 0; childrenIndex < options.children.length; childrenIndex++) {\n\n        var child = options.children[childrenIndex];\n        var childElement;\n\n        if (typeof child === 'string' && child in toolbarBuiltInButtons) {\n            childElement = createToolbarButton(toolbarBuiltInButtons[child], true, enableTooltips, shortcuts, 'button', parent);\n        } else {\n            childElement = createToolbarButton(child, true, enableTooltips, shortcuts, 'button', parent);\n        }\n\n        childElement.addEventListener('click', function (e) { e.stopPropagation(); }, false);\n        content.appendChild(childElement);\n    }\n    el.appendChild(content);\n    return el;\n}\n\n/**\n * Create button element for toolbar.\n */\nfunction createToolbarButton(options, enableActions, enableTooltips, shortcuts, markup, parent) {\n    options = options || {};\n    var el = document.createElement(markup);\n\n    // Add 'custom' attributes as early as possible, so that 'official' attributes will never be overwritten.\n    if (options.attributes) {\n        for (var attribute in options.attributes) {\n            if (Object.prototype.hasOwnProperty.call(options.attributes, attribute)) {\n                el.setAttribute(attribute, options.attributes[attribute]);\n            }\n        }\n    }\n\n    el.className = options.name;\n    el.setAttribute('type', markup);\n    enableTooltips = (enableTooltips == undefined) ? true : enableTooltips;\n\n    // Properly hande custom shortcuts\n    if (options.name && options.name in shortcuts) {\n        bindings[options.name] = options.action;\n    }\n\n    if (options.title && enableTooltips) {\n        el.title = createTooltip(options.title, options.action, shortcuts);\n\n        if (isMac) {\n            el.title = el.title.replace('Ctrl', 'âŒ˜');\n            el.title = el.title.replace('Alt', 'âŒ¥');\n        }\n    }\n\n    if (options.noDisable) {\n        el.classList.add('no-disable');\n    }\n\n    if (options.noMobile) {\n        el.classList.add('no-mobile');\n    }\n\n    // Prevent errors if there is no class name in custom options\n    var classNameParts = [];\n    if (typeof options.className !== 'undefined') {\n        classNameParts = options.className.split(' ');\n    }\n\n    // Provide backwards compatibility with simple-markdown-editor by adding custom classes to the button.\n    var iconClasses = [];\n    for (var classNameIndex = 0; classNameIndex < classNameParts.length; classNameIndex++) {\n        var classNamePart = classNameParts[classNameIndex];\n        // Split icon classes from the button.\n        // Regex will detect \"fa\", \"fas\", \"fa-something\" and \"fa-some-icon-1\", but not \"fanfare\".\n        if (classNamePart.match(/^fa([srlb]|(-[\\w-]*)|$)/)) {\n            iconClasses.push(classNamePart);\n        } else {\n            el.classList.add(classNamePart);\n        }\n    }\n\n    el.tabIndex = -1;\n\n    // Create icon element and append as a child to the button\n    var icon = document.createElement('i');\n    for (var iconClassIndex = 0; iconClassIndex < iconClasses.length; iconClassIndex++) {\n        var iconClass = iconClasses[iconClassIndex];\n        icon.classList.add(iconClass);\n    }\n    el.appendChild(icon);\n\n    // If there is a custom icon markup set, use that\n    if (typeof options.icon !== 'undefined') {\n        el.innerHTML = options.icon;\n    }\n\n    if (options.action && enableActions) {\n        if (typeof options.action === 'function') {\n            el.onclick = function (e) {\n                e.preventDefault();\n                options.action(parent);\n            };\n        } else if (typeof options.action === 'string') {\n            el.onclick = function (e) {\n                e.preventDefault();\n                window.open(options.action, '_blank');\n            };\n        }\n    }\n\n    return el;\n}\n\nfunction createSep() {\n    var el = document.createElement('i');\n    el.className = 'separator';\n    el.innerHTML = '|';\n    return el;\n}\n\nfunction createTooltip(title, action, shortcuts) {\n    var actionName;\n    var tooltip = title;\n\n    if (action) {\n        actionName = getBindingName(action);\n        if (shortcuts[actionName]) {\n            tooltip += ' (' + fixShortcut(shortcuts[actionName]) + ')';\n        }\n    }\n\n    return tooltip;\n}\n\n/**\n * The state of CodeMirror at the given position.\n */\nfunction getState(cm, pos) {\n    pos = pos || cm.getCursor('start');\n    var stat = cm.getTokenAt(pos);\n    if (!stat.type) return {};\n\n    var types = stat.type.split(' ');\n\n    var ret = {},\n        data, text;\n    for (var i = 0; i < types.length; i++) {\n        data = types[i];\n        if (data === 'strong') {\n            ret.bold = true;\n        } else if (data === 'variable-2') {\n            text = cm.getLine(pos.line);\n            if (/^\\s*\\d+\\.\\s/.test(text)) {\n                ret['ordered-list'] = true;\n            } else {\n                ret['unordered-list'] = true;\n            }\n        } else if (data === 'atom') {\n            ret.quote = true;\n        } else if (data === 'em') {\n            ret.italic = true;\n        } else if (data === 'quote') {\n            ret.quote = true;\n        } else if (data === 'strikethrough') {\n            ret.strikethrough = true;\n        } else if (data === 'comment') {\n            ret.code = true;\n        } else if (data === 'link') {\n            ret.link = true;\n        } else if (data === 'tag') {\n            ret.image = true;\n        } else if (data.match(/^header(-[1-6])?$/)) {\n            ret[data.replace('header', 'heading')] = true;\n        }\n    }\n    return ret;\n}\n\n\n// Saved overflow setting\nvar saved_overflow = '';\n\n/**\n * Toggle full screen of the editor.\n */\nfunction toggleFullScreen(editor) {\n    // Set fullscreen\n    var cm = editor.codemirror;\n    cm.setOption('fullScreen', !cm.getOption('fullScreen'));\n\n\n    // Prevent scrolling on body during fullscreen active\n    if (cm.getOption('fullScreen')) {\n        saved_overflow = document.body.style.overflow;\n        document.body.style.overflow = 'hidden';\n    } else {\n        document.body.style.overflow = saved_overflow;\n    }\n\n    var wrapper = cm.getWrapperElement();\n    var sidebyside = wrapper.nextSibling;\n\n    if (/editor-preview-active-side/.test(sidebyside.className)) {\n        if (editor.options.sideBySideFullscreen === false) {\n            // if side-by-side not-fullscreen ok, apply classes as needed\n            var easyMDEContainer = wrapper.parentNode;\n            if (cm.getOption('fullScreen')) {\n                removeClass(easyMDEContainer, 'sided--no-fullscreen');\n            } else {\n                addClass(easyMDEContainer, 'sided--no-fullscreen');\n            }\n        } else {\n            toggleSideBySide(editor);\n        }\n    }\n\n    if (editor.options.onToggleFullScreen) {\n        editor.options.onToggleFullScreen(cm.getOption('fullScreen') || false);\n    }\n\n    // Remove or set maxHeight\n    if (typeof editor.options.maxHeight !== 'undefined') {\n        if (cm.getOption('fullScreen')) {\n            cm.getScrollerElement().style.removeProperty('height');\n            sidebyside.style.removeProperty('height');\n        } else {\n            cm.getScrollerElement().style.height = editor.options.maxHeight;\n            editor.setPreviewMaxHeight();\n        }\n    }\n\n\n    // Update toolbar class\n    if (!/fullscreen/.test(editor.toolbar_div.className)) {\n        editor.toolbar_div.className += ' fullscreen';\n    } else {\n        editor.toolbar_div.className = editor.toolbar_div.className.replace(/\\s*fullscreen\\b/, '');\n    }\n\n\n    // Update toolbar button\n    if (editor.toolbarElements && editor.toolbarElements.fullscreen) {\n        var toolbarButton = editor.toolbarElements.fullscreen;\n\n        if (!/active/.test(toolbarButton.className)) {\n            toolbarButton.className += ' active';\n        } else {\n            toolbarButton.className = toolbarButton.className.replace(/\\s*active\\s*/g, '');\n        }\n    }\n}\n\n\n/**\n * Action for toggling bold.\n */\nfunction toggleBold(editor) {\n    _toggleBlock(editor, 'bold', editor.options.blockStyles.bold);\n}\n\n\n/**\n * Action for toggling italic.\n */\nfunction toggleItalic(editor) {\n    _toggleBlock(editor, 'italic', editor.options.blockStyles.italic);\n}\n\n\n/**\n * Action for toggling strikethrough.\n */\nfunction toggleStrikethrough(editor) {\n    _toggleBlock(editor, 'strikethrough', '~~');\n}\n\n/**\n * Action for toggling code block.\n */\nfunction toggleCodeBlock(editor) {\n    var fenceCharsToInsert = editor.options.blockStyles.code;\n\n    function fencing_line(line) {\n        /* return true, if this is a ``` or ~~~ line */\n        if (typeof line !== 'object') {\n            throw 'fencing_line() takes a \\'line\\' object (not a line number, or line text).  Got: ' + typeof line + ': ' + line;\n        }\n        return line.styles && line.styles[2] && line.styles[2].indexOf('formatting-code-block') !== -1;\n    }\n\n    function token_state(token) {\n        // base goes an extra level deep when mode backdrops are used, e.g. spellchecker on\n        return token.state.base.base || token.state.base;\n    }\n\n    function code_type(cm, line_num, line, firstTok, lastTok) {\n        /*\n         * Return \"single\", \"indented\", \"fenced\" or false\n         *\n         * cm and line_num are required.  Others are optional for efficiency\n         *   To check in the middle of a line, pass in firstTok yourself.\n         */\n        line = line || cm.getLineHandle(line_num);\n        firstTok = firstTok || cm.getTokenAt({\n            line: line_num,\n            ch: 1,\n        });\n        lastTok = lastTok || (!!line.text && cm.getTokenAt({\n            line: line_num,\n            ch: line.text.length - 1,\n        }));\n        var types = firstTok.type ? firstTok.type.split(' ') : [];\n        if (lastTok && token_state(lastTok).indentedCode) {\n            // have to check last char, since first chars of first line aren\"t marked as indented\n            return 'indented';\n        } else if (types.indexOf('comment') === -1) {\n            // has to be after \"indented\" check, since first chars of first indented line aren\"t marked as such\n            return false;\n        } else if (token_state(firstTok).fencedChars || token_state(lastTok).fencedChars || fencing_line(line)) {\n            return 'fenced';\n        } else {\n            return 'single';\n        }\n    }\n\n    function insertFencingAtSelection(cm, cur_start, cur_end, fenceCharsToInsert) {\n        var start_line_sel = cur_start.line + 1,\n            end_line_sel = cur_end.line + 1,\n            sel_multi = cur_start.line !== cur_end.line,\n            repl_start = fenceCharsToInsert + '\\n',\n            repl_end = '\\n' + fenceCharsToInsert;\n        if (sel_multi) {\n            end_line_sel++;\n        }\n        // handle last char including \\n or not\n        if (sel_multi && cur_end.ch === 0) {\n            repl_end = fenceCharsToInsert + '\\n';\n            end_line_sel--;\n        }\n        _replaceSelection(cm, false, [repl_start, repl_end]);\n        cm.setSelection({\n            line: start_line_sel,\n            ch: 0,\n        }, {\n            line: end_line_sel,\n            ch: 0,\n        });\n    }\n\n    var cm = editor.codemirror,\n        cur_start = cm.getCursor('start'),\n        cur_end = cm.getCursor('end'),\n        tok = cm.getTokenAt({\n            line: cur_start.line,\n            ch: cur_start.ch || 1,\n        }), // avoid ch 0 which is a cursor pos but not token\n        line = cm.getLineHandle(cur_start.line),\n        is_code = code_type(cm, cur_start.line, line, tok);\n    var block_start, block_end, lineCount;\n\n    if (is_code === 'single') {\n        // similar to some EasyMDE _toggleBlock logic\n        var start = line.text.slice(0, cur_start.ch).replace('`', ''),\n            end = line.text.slice(cur_start.ch).replace('`', '');\n        cm.replaceRange(start + end, {\n            line: cur_start.line,\n            ch: 0,\n        }, {\n            line: cur_start.line,\n            ch: 99999999999999,\n        });\n        cur_start.ch--;\n        if (cur_start !== cur_end) {\n            cur_end.ch--;\n        }\n        cm.setSelection(cur_start, cur_end);\n        cm.focus();\n    } else if (is_code === 'fenced') {\n        if (cur_start.line !== cur_end.line || cur_start.ch !== cur_end.ch) {\n            // use selection\n\n            // find the fenced line so we know what type it is (tilde, backticks, number of them)\n            for (block_start = cur_start.line; block_start >= 0; block_start--) {\n                line = cm.getLineHandle(block_start);\n                if (fencing_line(line)) {\n                    break;\n                }\n            }\n            var fencedTok = cm.getTokenAt({\n                line: block_start,\n                ch: 1,\n            });\n            var fence_chars = token_state(fencedTok).fencedChars;\n            var start_text, start_line;\n            var end_text, end_line;\n            // check for selection going up against fenced lines, in which case we don't want to add more fencing\n            if (fencing_line(cm.getLineHandle(cur_start.line))) {\n                start_text = '';\n                start_line = cur_start.line;\n            } else if (fencing_line(cm.getLineHandle(cur_start.line - 1))) {\n                start_text = '';\n                start_line = cur_start.line - 1;\n            } else {\n                start_text = fence_chars + '\\n';\n                start_line = cur_start.line;\n            }\n            if (fencing_line(cm.getLineHandle(cur_end.line))) {\n                end_text = '';\n                end_line = cur_end.line;\n                if (cur_end.ch === 0) {\n                    end_line += 1;\n                }\n            } else if (cur_end.ch !== 0 && fencing_line(cm.getLineHandle(cur_end.line + 1))) {\n                end_text = '';\n                end_line = cur_end.line + 1;\n            } else {\n                end_text = fence_chars + '\\n';\n                end_line = cur_end.line + 1;\n            }\n            if (cur_end.ch === 0) {\n                // full last line selected, putting cursor at beginning of next\n                end_line -= 1;\n            }\n            cm.operation(function () {\n                // end line first, so that line numbers don't change\n                cm.replaceRange(end_text, {\n                    line: end_line,\n                    ch: 0,\n                }, {\n                    line: end_line + (end_text ? 0 : 1),\n                    ch: 0,\n                });\n                cm.replaceRange(start_text, {\n                    line: start_line,\n                    ch: 0,\n                }, {\n                    line: start_line + (start_text ? 0 : 1),\n                    ch: 0,\n                });\n            });\n            cm.setSelection({\n                line: start_line + (start_text ? 1 : 0),\n                ch: 0,\n            }, {\n                line: end_line + (start_text ? 1 : -1),\n                ch: 0,\n            });\n            cm.focus();\n        } else {\n            // no selection, search for ends of this fenced block\n            var search_from = cur_start.line;\n            if (fencing_line(cm.getLineHandle(cur_start.line))) { // gets a little tricky if cursor is right on a fenced line\n                if (code_type(cm, cur_start.line + 1) === 'fenced') {\n                    block_start = cur_start.line;\n                    search_from = cur_start.line + 1; // for searching for \"end\"\n                } else {\n                    block_end = cur_start.line;\n                    search_from = cur_start.line - 1; // for searching for \"start\"\n                }\n            }\n            if (block_start === undefined) {\n                for (block_start = search_from; block_start >= 0; block_start--) {\n                    line = cm.getLineHandle(block_start);\n                    if (fencing_line(line)) {\n                        break;\n                    }\n                }\n            }\n            if (block_end === undefined) {\n                lineCount = cm.lineCount();\n                for (block_end = search_from; block_end < lineCount; block_end++) {\n                    line = cm.getLineHandle(block_end);\n                    if (fencing_line(line)) {\n                        break;\n                    }\n                }\n            }\n            cm.operation(function () {\n                cm.replaceRange('', {\n                    line: block_start,\n                    ch: 0,\n                }, {\n                    line: block_start + 1,\n                    ch: 0,\n                });\n                cm.replaceRange('', {\n                    line: block_end - 1,\n                    ch: 0,\n                }, {\n                    line: block_end,\n                    ch: 0,\n                });\n            });\n            cm.focus();\n        }\n    } else if (is_code === 'indented') {\n        if (cur_start.line !== cur_end.line || cur_start.ch !== cur_end.ch) {\n            // use selection\n            block_start = cur_start.line;\n            block_end = cur_end.line;\n            if (cur_end.ch === 0) {\n                block_end--;\n            }\n        } else {\n            // no selection, search for ends of this indented block\n            for (block_start = cur_start.line; block_start >= 0; block_start--) {\n                line = cm.getLineHandle(block_start);\n                if (line.text.match(/^\\s*$/)) {\n                    // empty or all whitespace - keep going\n                    continue;\n                } else {\n                    if (code_type(cm, block_start, line) !== 'indented') {\n                        block_start += 1;\n                        break;\n                    }\n                }\n            }\n            lineCount = cm.lineCount();\n            for (block_end = cur_start.line; block_end < lineCount; block_end++) {\n                line = cm.getLineHandle(block_end);\n                if (line.text.match(/^\\s*$/)) {\n                    // empty or all whitespace - keep going\n                    continue;\n                } else {\n                    if (code_type(cm, block_end, line) !== 'indented') {\n                        block_end -= 1;\n                        break;\n                    }\n                }\n            }\n        }\n        // if we are going to un-indent based on a selected set of lines, and the next line is indented too, we need to\n        // insert a blank line so that the next line(s) continue to be indented code\n        var next_line = cm.getLineHandle(block_end + 1),\n            next_line_last_tok = next_line && cm.getTokenAt({\n                line: block_end + 1,\n                ch: next_line.text.length - 1,\n            }),\n            next_line_indented = next_line_last_tok && token_state(next_line_last_tok).indentedCode;\n        if (next_line_indented) {\n            cm.replaceRange('\\n', {\n                line: block_end + 1,\n                ch: 0,\n            });\n        }\n\n        for (var i = block_start; i <= block_end; i++) {\n            cm.indentLine(i, 'subtract'); // TODO: this doesn't get tracked in the history, so can't be undone :(\n        }\n        cm.focus();\n    } else {\n        // insert code formatting\n        var no_sel_and_starting_of_line = (cur_start.line === cur_end.line && cur_start.ch === cur_end.ch && cur_start.ch === 0);\n        var sel_multi = cur_start.line !== cur_end.line;\n        if (no_sel_and_starting_of_line || sel_multi) {\n            insertFencingAtSelection(cm, cur_start, cur_end, fenceCharsToInsert);\n        } else {\n            _replaceSelection(cm, false, ['`', '`']);\n        }\n    }\n}\n\n/**\n * Action for toggling blockquote.\n */\nfunction toggleBlockquote(editor) {\n    var cm = editor.codemirror;\n    _toggleLine(cm, 'quote');\n}\n\n/**\n * Action for toggling heading size: normal -> h1 -> h2 -> h3 -> h4 -> h5 -> h6 -> normal\n */\nfunction toggleHeadingSmaller(editor) {\n    var cm = editor.codemirror;\n    _toggleHeading(cm, 'smaller');\n}\n\n/**\n * Action for toggling heading size: normal -> h6 -> h5 -> h4 -> h3 -> h2 -> h1 -> normal\n */\nfunction toggleHeadingBigger(editor) {\n    var cm = editor.codemirror;\n    _toggleHeading(cm, 'bigger');\n}\n\n/**\n * Action for toggling heading size 1\n */\nfunction toggleHeading1(editor) {\n    var cm = editor.codemirror;\n    _toggleHeading(cm, undefined, 1);\n}\n\n/**\n * Action for toggling heading size 2\n */\nfunction toggleHeading2(editor) {\n    var cm = editor.codemirror;\n    _toggleHeading(cm, undefined, 2);\n}\n\n/**\n * Action for toggling heading size 3\n */\nfunction toggleHeading3(editor) {\n    var cm = editor.codemirror;\n    _toggleHeading(cm, undefined, 3);\n}\n\n\n/**\n * Action for toggling ul.\n */\nfunction toggleUnorderedList(editor) {\n    var cm = editor.codemirror;\n\n    var listStyle = '*'; // Default\n    if (['-', '+', '*'].includes(editor.options.unorderedListStyle)) {\n        listStyle = editor.options.unorderedListStyle;\n    }\n\n    _toggleLine(cm, 'unordered-list', listStyle);\n}\n\n\n/**\n * Action for toggling ol.\n */\nfunction toggleOrderedList(editor) {\n    var cm = editor.codemirror;\n    _toggleLine(cm, 'ordered-list');\n}\n\n/**\n * Action for clean block (remove headline, list, blockquote code, markers)\n */\nfunction cleanBlock(editor) {\n    var cm = editor.codemirror;\n    _cleanBlock(cm);\n}\n\n/**\n * Action for drawing a link.\n */\nfunction drawLink(editor) {\n    var cm = editor.codemirror;\n    var stat = getState(cm);\n    var options = editor.options;\n    var url = 'https://';\n    if (options.promptURLs) {\n        url = prompt(options.promptTexts.link, 'https://');\n        if (!url) {\n            return false;\n        }\n    }\n    _replaceSelection(cm, stat.link, options.insertTexts.link, url);\n}\n\n/**\n * Action for drawing an img.\n */\nfunction drawImage(editor) {\n    var cm = editor.codemirror;\n    var stat = getState(cm);\n    var options = editor.options;\n    var url = 'https://';\n    if (options.promptURLs) {\n        url = prompt(options.promptTexts.image, 'https://');\n        if (!url) {\n            return false;\n        }\n    }\n    _replaceSelection(cm, stat.image, options.insertTexts.image, url);\n}\n\n/**\n * Action for opening the browse-file window to upload an image to a server.\n * @param editor {EasyMDE} The EasyMDE object\n */\nfunction drawUploadedImage(editor) {\n    // TODO: Draw the image template with a fake url? ie: '![](importing foo.png...)'\n    editor.openBrowseFileWindow();\n}\n\n/**\n * Action executed after an image have been successfully imported on the server.\n * @param editor {EasyMDE} The EasyMDE object\n * @param url {string} The url of the uploaded image\n */\nfunction afterImageUploaded(editor, url) {\n    var cm = editor.codemirror;\n    var stat = getState(cm);\n    var options = editor.options;\n    var imageName = url.substr(url.lastIndexOf('/') + 1);\n    var ext = imageName.substring(imageName.lastIndexOf('.') + 1).replace(/\\?.*$/, '').toLowerCase();\n\n    // Check if media is an image\n    if (['png', 'jpg', 'jpeg', 'gif', 'svg'].includes(ext)) {\n        _replaceSelection(cm, stat.image, options.insertTexts.uploadedImage, url);\n    } else {\n        var text_link = options.insertTexts.link;\n        text_link[0] = '[' + imageName;\n        _replaceSelection(cm, stat.link, text_link, url);\n    }\n\n    // show uploaded image filename for 1000ms\n    editor.updateStatusBar('upload-image', editor.options.imageTexts.sbOnUploaded.replace('#image_name#', imageName));\n    setTimeout(function () {\n        editor.updateStatusBar('upload-image', editor.options.imageTexts.sbInit);\n    }, 1000);\n}\n\n/**\n * Action for drawing a table.\n */\nfunction drawTable(editor) {\n    var cm = editor.codemirror;\n    var stat = getState(cm);\n    var options = editor.options;\n    _replaceSelection(cm, stat.table, options.insertTexts.table);\n}\n\n/**\n * Action for drawing a horizontal rule.\n */\nfunction drawHorizontalRule(editor) {\n    var cm = editor.codemirror;\n    var stat = getState(cm);\n    var options = editor.options;\n    _replaceSelection(cm, stat.image, options.insertTexts.horizontalRule);\n}\n\n\n/**\n * Undo action.\n */\nfunction undo(editor) {\n    var cm = editor.codemirror;\n    cm.undo();\n    cm.focus();\n}\n\n\n/**\n * Redo action.\n */\nfunction redo(editor) {\n    var cm = editor.codemirror;\n    cm.redo();\n    cm.focus();\n}\n\n\n/**\n * Toggle side by side preview\n */\nfunction toggleSideBySide(editor) {\n    var cm = editor.codemirror;\n    var wrapper = cm.getWrapperElement();\n    var preview = wrapper.nextSibling;\n    var toolbarButton = editor.toolbarElements && editor.toolbarElements['side-by-side'];\n    var useSideBySideListener = false;\n\n    var easyMDEContainer = wrapper.parentNode;\n\n    if (/editor-preview-active-side/.test(preview.className)) {\n        if (editor.options.sideBySideFullscreen === false) {\n            // if side-by-side not-fullscreen ok, remove classes when hiding side\n            removeClass(easyMDEContainer, 'sided--no-fullscreen');\n        }\n        preview.className = preview.className.replace(\n            /\\s*editor-preview-active-side\\s*/g, ''\n        );\n        if (toolbarButton) toolbarButton.className = toolbarButton.className.replace(/\\s*active\\s*/g, '');\n        wrapper.className = wrapper.className.replace(/\\s*CodeMirror-sided\\s*/g, ' ');\n    } else {\n        // When the preview button is clicked for the first time,\n        // give some time for the transition from editor.css to fire and the view to slide from right to left,\n        // instead of just appearing.\n        setTimeout(function () {\n            if (!cm.getOption('fullScreen')) {\n                if (editor.options.sideBySideFullscreen === false) {\n                    // if side-by-side not-fullscreen ok, add classes when not fullscreen and showing side\n                    addClass(easyMDEContainer, 'sided--no-fullscreen');\n                } else {\n                    toggleFullScreen(editor);\n                }\n            }\n            preview.className += ' editor-preview-active-side';\n        }, 1);\n        if (toolbarButton) toolbarButton.className += ' active';\n        wrapper.className += ' CodeMirror-sided';\n        useSideBySideListener = true;\n    }\n\n    // Hide normal preview if active\n    var previewNormal = wrapper.lastChild;\n    if (/editor-preview-active/.test(previewNormal.className)) {\n        previewNormal.className = previewNormal.className.replace(\n            /\\s*editor-preview-active\\s*/g, ''\n        );\n        var toolbar = editor.toolbarElements.preview;\n        var toolbar_div = editor.toolbar_div;\n        toolbar.className = toolbar.className.replace(/\\s*active\\s*/g, '');\n        toolbar_div.className = toolbar_div.className.replace(/\\s*disabled-for-preview*/g, '');\n    }\n\n    var sideBySideRenderingFunction = function () {\n        var newValue = editor.options.previewRender(editor.value(), preview);\n        if (newValue != null) {\n            preview.innerHTML = newValue;\n        }\n    };\n\n    if (!cm.sideBySideRenderingFunction) {\n        cm.sideBySideRenderingFunction = sideBySideRenderingFunction;\n    }\n\n    if (useSideBySideListener) {\n        var newValue = editor.options.previewRender(editor.value(), preview);\n        if (newValue != null) {\n            preview.innerHTML = newValue;\n        }\n        cm.on('update', cm.sideBySideRenderingFunction);\n    } else {\n        cm.off('update', cm.sideBySideRenderingFunction);\n    }\n\n    // Refresh to fix selection being off (#309)\n    cm.refresh();\n}\n\n\n/**\n * Preview action.\n */\nfunction togglePreview(editor) {\n    var cm = editor.codemirror;\n    var wrapper = cm.getWrapperElement();\n    var toolbar_div = editor.toolbar_div;\n    var toolbar = editor.options.toolbar ? editor.toolbarElements.preview : false;\n    var preview = wrapper.lastChild;\n\n    // Turn off side by side if needed\n    var sidebyside = cm.getWrapperElement().nextSibling;\n    if (/editor-preview-active-side/.test(sidebyside.className))\n        toggleSideBySide(editor);\n\n    if (!preview || !/editor-preview-full/.test(preview.className)) {\n\n        preview = document.createElement('div');\n        preview.className = 'editor-preview-full';\n\n        if (editor.options.previewClass) {\n\n            if (Array.isArray(editor.options.previewClass)) {\n                for (var i = 0; i < editor.options.previewClass.length; i++) {\n                    preview.className += (' ' + editor.options.previewClass[i]);\n                }\n\n            } else if (typeof editor.options.previewClass === 'string') {\n                preview.className += (' ' + editor.options.previewClass);\n            }\n        }\n\n        wrapper.appendChild(preview);\n    }\n\n    if (/editor-preview-active/.test(preview.className)) {\n        preview.className = preview.className.replace(\n            /\\s*editor-preview-active\\s*/g, ''\n        );\n        if (toolbar) {\n            toolbar.className = toolbar.className.replace(/\\s*active\\s*/g, '');\n            toolbar_div.className = toolbar_div.className.replace(/\\s*disabled-for-preview*/g, '');\n        }\n    } else {\n        // When the preview button is clicked for the first time,\n        // give some time for the transition from editor.css to fire and the view to slide from right to left,\n        // instead of just appearing.\n        setTimeout(function () {\n            preview.className += ' editor-preview-active';\n        }, 1);\n        if (toolbar) {\n            toolbar.className += ' active';\n            toolbar_div.className += ' disabled-for-preview';\n        }\n    }\n    preview.innerHTML = editor.options.previewRender(editor.value(), preview);\n\n}\n\nfunction _replaceSelection(cm, active, startEnd, url) {\n    if (/editor-preview-active/.test(cm.getWrapperElement().lastChild.className))\n        return;\n\n    var text;\n    var start = startEnd[0];\n    var end = startEnd[1];\n    var startPoint = {},\n        endPoint = {};\n    Object.assign(startPoint, cm.getCursor('start'));\n    Object.assign(endPoint, cm.getCursor('end'));\n    if (url) {\n        start = start.replace('#url#', url);  // url is in start for upload-image\n        end = end.replace('#url#', url);\n    }\n    if (active) {\n        text = cm.getLine(startPoint.line);\n        start = text.slice(0, startPoint.ch);\n        end = text.slice(startPoint.ch);\n        cm.replaceRange(start + end, {\n            line: startPoint.line,\n            ch: 0,\n        });\n    } else {\n        text = cm.getSelection();\n        cm.replaceSelection(start + text + end);\n\n        startPoint.ch += start.length;\n        if (startPoint !== endPoint) {\n            endPoint.ch += start.length;\n        }\n    }\n    cm.setSelection(startPoint, endPoint);\n    cm.focus();\n}\n\n\nfunction _toggleHeading(cm, direction, size) {\n    if (/editor-preview-active/.test(cm.getWrapperElement().lastChild.className))\n        return;\n\n    var startPoint = cm.getCursor('start');\n    var endPoint = cm.getCursor('end');\n    for (var i = startPoint.line; i <= endPoint.line; i++) {\n        (function (i) {\n            var text = cm.getLine(i);\n            var currHeadingLevel = text.search(/[^#]/);\n\n            if (direction !== undefined) {\n                if (currHeadingLevel <= 0) {\n                    if (direction == 'bigger') {\n                        text = '###### ' + text;\n                    } else {\n                        text = '# ' + text;\n                    }\n                } else if (currHeadingLevel == 6 && direction == 'smaller') {\n                    text = text.substr(7);\n                } else if (currHeadingLevel == 1 && direction == 'bigger') {\n                    text = text.substr(2);\n                } else {\n                    if (direction == 'bigger') {\n                        text = text.substr(1);\n                    } else {\n                        text = '#' + text;\n                    }\n                }\n            } else {\n                if (size == 1) {\n                    if (currHeadingLevel <= 0) {\n                        text = '# ' + text;\n                    } else if (currHeadingLevel == size) {\n                        text = text.substr(currHeadingLevel + 1);\n                    } else {\n                        text = '# ' + text.substr(currHeadingLevel + 1);\n                    }\n                } else if (size == 2) {\n                    if (currHeadingLevel <= 0) {\n                        text = '## ' + text;\n                    } else if (currHeadingLevel == size) {\n                        text = text.substr(currHeadingLevel + 1);\n                    } else {\n                        text = '## ' + text.substr(currHeadingLevel + 1);\n                    }\n                } else {\n                    if (currHeadingLevel <= 0) {\n                        text = '### ' + text;\n                    } else if (currHeadingLevel == size) {\n                        text = text.substr(currHeadingLevel + 1);\n                    } else {\n                        text = '### ' + text.substr(currHeadingLevel + 1);\n                    }\n                }\n            }\n\n            cm.replaceRange(text, {\n                line: i,\n                ch: 0,\n            }, {\n                line: i,\n                ch: 99999999999999,\n            });\n        })(i);\n    }\n    cm.focus();\n}\n\n\nfunction _toggleLine(cm, name, liststyle) {\n    if (/editor-preview-active/.test(cm.getWrapperElement().lastChild.className))\n        return;\n\n    var listRegexp = /^(\\s*)(\\*|-|\\+|\\d*\\.)(\\s+)/;\n    var whitespacesRegexp = /^\\s*/;\n\n    var stat = getState(cm);\n    var startPoint = cm.getCursor('start');\n    var endPoint = cm.getCursor('end');\n    var repl = {\n        'quote': /^(\\s*)>\\s+/,\n        'unordered-list': listRegexp,\n        'ordered-list': listRegexp,\n    };\n\n    var _getChar = function (name, i) {\n        var map = {\n            'quote': '>',\n            'unordered-list': liststyle,\n            'ordered-list': '%%i.',\n        };\n\n        return map[name].replace('%%i', i);\n    };\n\n    var _checkChar = function (name, char) {\n        var map = {\n            'quote': '>',\n            'unordered-list': '\\\\' + liststyle,\n            'ordered-list': '\\\\d+.',\n        };\n        var rt = new RegExp(map[name]);\n\n        return char && rt.test(char);\n    };\n\n    var _toggle = function (name, text, untoggleOnly) {\n        var arr = listRegexp.exec(text);\n        var char = _getChar(name, line);\n        if (arr !== null) {\n            if (_checkChar(name, arr[2])) {\n                char = '';\n            }\n            text = arr[1] + char + arr[3] + text.replace(whitespacesRegexp, '').replace(repl[name], '$1');\n        } else if (untoggleOnly == false) {\n            text = char + ' ' + text;\n        }\n        return text;\n    };\n\n    var line = 1;\n    for (var i = startPoint.line; i <= endPoint.line; i++) {\n        (function (i) {\n            var text = cm.getLine(i);\n            if (stat[name]) {\n                text = text.replace(repl[name], '$1');\n            } else {\n                // If we're toggling unordered-list formatting, check if the current line\n                // is part of an ordered-list, and if so, untoggle that first.\n                // Workaround for https://github.com/Ionaru/easy-markdown-editor/issues/92\n                if (name == 'unordered-list') {\n                    text = _toggle('ordered-list', text, true);\n                }\n                text = _toggle(name, text, false);\n                line += 1;\n            }\n            cm.replaceRange(text, {\n                line: i,\n                ch: 0,\n            }, {\n                line: i,\n                ch: 99999999999999,\n            });\n        })(i);\n    }\n    cm.focus();\n}\n\nfunction _toggleBlock(editor, type, start_chars, end_chars) {\n    if (/editor-preview-active/.test(editor.codemirror.getWrapperElement().lastChild.className))\n        return;\n\n    end_chars = (typeof end_chars === 'undefined') ? start_chars : end_chars;\n    var cm = editor.codemirror;\n    var stat = getState(cm);\n\n    var text;\n    var start = start_chars;\n    var end = end_chars;\n\n    var startPoint = cm.getCursor('start');\n    var endPoint = cm.getCursor('end');\n\n    if (stat[type]) {\n        text = cm.getLine(startPoint.line);\n        start = text.slice(0, startPoint.ch);\n        end = text.slice(startPoint.ch);\n        if (type == 'bold') {\n            start = start.replace(/(\\*\\*|__)(?![\\s\\S]*(\\*\\*|__))/, '');\n            end = end.replace(/(\\*\\*|__)/, '');\n        } else if (type == 'italic') {\n            start = start.replace(/(\\*|_)(?![\\s\\S]*(\\*|_))/, '');\n            end = end.replace(/(\\*|_)/, '');\n        } else if (type == 'strikethrough') {\n            start = start.replace(/(\\*\\*|~~)(?![\\s\\S]*(\\*\\*|~~))/, '');\n            end = end.replace(/(\\*\\*|~~)/, '');\n        }\n        cm.replaceRange(start + end, {\n            line: startPoint.line,\n            ch: 0,\n        }, {\n            line: startPoint.line,\n            ch: 99999999999999,\n        });\n\n        if (type == 'bold' || type == 'strikethrough') {\n            startPoint.ch -= 2;\n            if (startPoint !== endPoint) {\n                endPoint.ch -= 2;\n            }\n        } else if (type == 'italic') {\n            startPoint.ch -= 1;\n            if (startPoint !== endPoint) {\n                endPoint.ch -= 1;\n            }\n        }\n    } else {\n        text = cm.getSelection();\n        if (type == 'bold') {\n            text = text.split('**').join('');\n            text = text.split('__').join('');\n        } else if (type == 'italic') {\n            text = text.split('*').join('');\n            text = text.split('_').join('');\n        } else if (type == 'strikethrough') {\n            text = text.split('~~').join('');\n        }\n        cm.replaceSelection(start + text + end);\n\n        startPoint.ch += start_chars.length;\n        endPoint.ch = startPoint.ch + text.length;\n    }\n\n    cm.setSelection(startPoint, endPoint);\n    cm.focus();\n}\n\nfunction _cleanBlock(cm) {\n    if (/editor-preview-active/.test(cm.getWrapperElement().lastChild.className))\n        return;\n\n    var startPoint = cm.getCursor('start');\n    var endPoint = cm.getCursor('end');\n    var text;\n\n    for (var line = startPoint.line; line <= endPoint.line; line++) {\n        text = cm.getLine(line);\n        text = text.replace(/^[ ]*([# ]+|\\*|-|[> ]+|[0-9]+(.|\\)))[ ]*/, '');\n\n        cm.replaceRange(text, {\n            line: line,\n            ch: 0,\n        }, {\n            line: line,\n            ch: 99999999999999,\n        });\n    }\n}\n\n/**\n * Convert a number of bytes to a human-readable file size. If you desire\n * to add a space between the value and the unit, you need to add this space\n * to the given units.\n * @param bytes {integer} A number of bytes, as integer. Ex: 421137\n * @param units {number[]} An array of human-readable units, ie. [' B', ' K', ' MB']\n * @returns string A human-readable file size. Ex: '412 KB'\n */\nfunction humanFileSize(bytes, units) {\n    if (Math.abs(bytes) < 1024) {\n        return '' + bytes + units[0];\n    }\n    var u = 0;\n    do {\n        bytes /= 1024;\n        ++u;\n    } while (Math.abs(bytes) >= 1024 && u < units.length);\n    return '' + bytes.toFixed(1) + units[u];\n}\n\n// Merge the properties of one object into another.\nfunction _mergeProperties(target, source) {\n    for (var property in source) {\n        if (Object.prototype.hasOwnProperty.call(source, property)) {\n            if (source[property] instanceof Array) {\n                target[property] = source[property].concat(target[property] instanceof Array ? target[property] : []);\n            } else if (\n                source[property] !== null &&\n                typeof source[property] === 'object' &&\n                source[property].constructor === Object\n            ) {\n                target[property] = _mergeProperties(target[property] || {}, source[property]);\n            } else {\n                target[property] = source[property];\n            }\n        }\n    }\n\n    return target;\n}\n\n// Merge an arbitrary number of objects into one.\nfunction extend(target) {\n    for (var i = 1; i < arguments.length; i++) {\n        target = _mergeProperties(target, arguments[i]);\n    }\n\n    return target;\n}\n\n/* The right word count in respect for CJK. */\nfunction wordCount(data) {\n    var pattern = /[a-zA-Z0-9_\\u00A0-\\u02AF\\u0392-\\u03c9\\u0410-\\u04F9]+|[\\u4E00-\\u9FFF\\u3400-\\u4dbf\\uf900-\\ufaff\\u3040-\\u309f\\uac00-\\ud7af]+/g;\n    var m = data.match(pattern);\n    var count = 0;\n    if (m === null) return count;\n    for (var i = 0; i < m.length; i++) {\n        if (m[i].charCodeAt(0) >= 0x4E00) {\n            count += m[i].length;\n        } else {\n            count += 1;\n        }\n    }\n    return count;\n}\n\nvar toolbarBuiltInButtons = {\n    'bold': {\n        name: 'bold',\n        action: toggleBold,\n        className: 'fa fa-bold',\n        title: 'Bold',\n        default: true,\n    },\n    'italic': {\n        name: 'italic',\n        action: toggleItalic,\n        className: 'fa fa-italic',\n        title: 'Italic',\n        default: true,\n    },\n    'strikethrough': {\n        name: 'strikethrough',\n        action: toggleStrikethrough,\n        className: 'fa fa-strikethrough',\n        title: 'Strikethrough',\n    },\n    'heading': {\n        name: 'heading',\n        action: toggleHeadingSmaller,\n        className: 'fa fa-header fa-heading',\n        title: 'Heading',\n        default: true,\n    },\n    'heading-smaller': {\n        name: 'heading-smaller',\n        action: toggleHeadingSmaller,\n        className: 'fa fa-header fa-heading header-smaller',\n        title: 'Smaller Heading',\n    },\n    'heading-bigger': {\n        name: 'heading-bigger',\n        action: toggleHeadingBigger,\n        className: 'fa fa-header fa-heading header-bigger',\n        title: 'Bigger Heading',\n    },\n    'heading-1': {\n        name: 'heading-1',\n        action: toggleHeading1,\n        className: 'fa fa-header fa-heading header-1',\n        title: 'Big Heading',\n    },\n    'heading-2': {\n        name: 'heading-2',\n        action: toggleHeading2,\n        className: 'fa fa-header fa-heading header-2',\n        title: 'Medium Heading',\n    },\n    'heading-3': {\n        name: 'heading-3',\n        action: toggleHeading3,\n        className: 'fa fa-header fa-heading header-3',\n        title: 'Small Heading',\n    },\n    'separator-1': {\n        name: 'separator-1',\n    },\n    'code': {\n        name: 'code',\n        action: toggleCodeBlock,\n        className: 'fa fa-code',\n        title: 'Code',\n    },\n    'quote': {\n        name: 'quote',\n        action: toggleBlockquote,\n        className: 'fa fa-quote-left',\n        title: 'Quote',\n        default: true,\n    },\n    'unordered-list': {\n        name: 'unordered-list',\n        action: toggleUnorderedList,\n        className: 'fa fa-list-ul',\n        title: 'Generic List',\n        default: true,\n    },\n    'ordered-list': {\n        name: 'ordered-list',\n        action: toggleOrderedList,\n        className: 'fa fa-list-ol',\n        title: 'Numbered List',\n        default: true,\n    },\n    'clean-block': {\n        name: 'clean-block',\n        action: cleanBlock,\n        className: 'fa fa-eraser',\n        title: 'Clean block',\n    },\n    'separator-2': {\n        name: 'separator-2',\n    },\n    'link': {\n        name: 'link',\n        action: drawLink,\n        className: 'fa fa-link',\n        title: 'Create Link',\n        default: true,\n    },\n    'image': {\n        name: 'image',\n        action: drawImage,\n        className: 'fa fa-image',\n        title: 'Insert Image',\n        default: true,\n    },\n    'upload-image': {\n        name: 'upload-image',\n        action: drawUploadedImage,\n        className: 'fa fa-image',\n        title: 'Import an image',\n    },\n    'table': {\n        name: 'table',\n        action: drawTable,\n        className: 'fa fa-table',\n        title: 'Insert Table',\n    },\n    'horizontal-rule': {\n        name: 'horizontal-rule',\n        action: drawHorizontalRule,\n        className: 'fa fa-minus',\n        title: 'Insert Horizontal Line',\n    },\n    'separator-3': {\n        name: 'separator-3',\n    },\n    'preview': {\n        name: 'preview',\n        action: togglePreview,\n        className: 'fa fa-eye',\n        noDisable: true,\n        title: 'Toggle Preview',\n        default: true,\n    },\n    'side-by-side': {\n        name: 'side-by-side',\n        action: toggleSideBySide,\n        className: 'fa fa-columns',\n        noDisable: true,\n        noMobile: true,\n        title: 'Toggle Side by Side',\n        default: true,\n    },\n    'fullscreen': {\n        name: 'fullscreen',\n        action: toggleFullScreen,\n        className: 'fa fa-arrows-alt',\n        noDisable: true,\n        noMobile: true,\n        title: 'Toggle Fullscreen',\n        default: true,\n    },\n    'separator-4': {\n        name: 'separator-4',\n    },\n    'guide': {\n        name: 'guide',\n        action: 'https://www.markdownguide.org/basic-syntax/',\n        className: 'fa fa-question-circle',\n        noDisable: true,\n        title: 'Markdown Guide',\n        default: true,\n    },\n    'separator-5': {\n        name: 'separator-5',\n    },\n    'undo': {\n        name: 'undo',\n        action: undo,\n        className: 'fa fa-undo',\n        noDisable: true,\n        title: 'Undo',\n    },\n    'redo': {\n        name: 'redo',\n        action: redo,\n        className: 'fa fa-repeat fa-redo',\n        noDisable: true,\n        title: 'Redo',\n    },\n};\n\nvar insertTexts = {\n    link: ['[', '](#url#)'],\n    image: ['![](', '#url#)'],\n    uploadedImage: ['![](#url#)', ''],\n    // uploadedImage: ['![](#url#)\\n', ''], // TODO: New line insertion doesn't work here.\n    table: ['', '\\n\\n| Column 1 | Column 2 | Column 3 |\\n| -------- | -------- | -------- |\\n| Text     | Text     | Text     |\\n\\n'],\n    horizontalRule: ['', '\\n\\n-----\\n\\n'],\n};\n\nvar promptTexts = {\n    link: 'URL for the link:',\n    image: 'URL of the image:',\n};\n\nvar timeFormat = {\n    locale: 'en-US',\n    format: {\n        hour: '2-digit',\n        minute: '2-digit',\n    },\n};\n\nvar blockStyles = {\n    'bold': '**',\n    'code': '```',\n    'italic': '*',\n};\n\n/**\n * Texts displayed to the user (mainly on the status bar) for the import image\n * feature. Can be used for customization or internationalization.\n */\nvar imageTexts = {\n    sbInit: 'Attach files by drag and dropping or pasting from clipboard.',\n    sbOnDragEnter: 'Drop image to upload it.',\n    sbOnDrop: 'Uploading image #images_names#...',\n    sbProgress: 'Uploading #file_name#: #progress#%',\n    sbOnUploaded: 'Uploaded #image_name#',\n    sizeUnits: ' B, KB, MB',\n};\n\n/**\n * Errors displayed to the user, using the `errorCallback` option. Can be used for\n * customization or internationalization.\n */\nvar errorMessages = {\n    noFileGiven: 'You must select a file.',\n    typeNotAllowed: 'This image type is not allowed.',\n    fileTooLarge: 'Image #image_name# is too big (#image_size#).\\n' +\n        'Maximum file size is #image_max_size#.',\n    importError: 'Something went wrong when uploading the image #image_name#.',\n};\n\n/**\n * Interface of EasyMDE.\n */\nfunction EasyMDE(options) {\n    // Handle options parameter\n    options = options || {};\n\n    // Used later to refer to it\"s parent\n    options.parent = this;\n\n    // Check if Font Awesome needs to be auto downloaded\n    var autoDownloadFA = true;\n\n    if (options.autoDownloadFontAwesome === false) {\n        autoDownloadFA = false;\n    }\n\n    if (options.autoDownloadFontAwesome !== true) {\n        var styleSheets = document.styleSheets;\n        for (var i = 0; i < styleSheets.length; i++) {\n            if (!styleSheets[i].href)\n                continue;\n\n            if (styleSheets[i].href.indexOf('//maxcdn.bootstrapcdn.com/font-awesome/') > -1) {\n                autoDownloadFA = false;\n            }\n        }\n    }\n\n    if (autoDownloadFA) {\n        var link = document.createElement('link');\n        link.rel = 'stylesheet';\n        link.href = 'https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css';\n        document.getElementsByTagName('head')[0].appendChild(link);\n    }\n\n\n    // Find the textarea to use\n    if (options.element) {\n        this.element = options.element;\n    } else if (options.element === null) {\n        // This means that the element option was specified, but no element was found\n        console.log('EasyMDE: Error. No element was found.');\n        return;\n    }\n\n\n    // Handle toolbar\n    if (options.toolbar === undefined) {\n        // Initialize\n        options.toolbar = [];\n\n\n        // Loop over the built in buttons, to get the preferred order\n        for (var key in toolbarBuiltInButtons) {\n            if (Object.prototype.hasOwnProperty.call(toolbarBuiltInButtons, key)) {\n                if (key.indexOf('separator-') != -1) {\n                    options.toolbar.push('|');\n                }\n\n                if (toolbarBuiltInButtons[key].default === true || (options.showIcons && options.showIcons.constructor === Array && options.showIcons.indexOf(key) != -1)) {\n                    options.toolbar.push(key);\n                }\n            }\n        }\n    }\n\n    // Editor preview styling class.\n    if (!Object.prototype.hasOwnProperty.call(options, 'previewClass')) {\n        options.previewClass = 'editor-preview';\n    }\n\n    // Handle status bar\n    if (!Object.prototype.hasOwnProperty.call(options, 'status')) {\n        options.status = ['autosave', 'lines', 'words', 'cursor'];\n\n        if (options.uploadImage) {\n            options.status.unshift('upload-image');\n        }\n    }\n\n\n    // Add default preview rendering function\n    if (!options.previewRender) {\n        options.previewRender = function (plainText) {\n            // Note: \"this\" refers to the options object\n            return this.parent.markdown(plainText);\n        };\n    }\n\n\n    // Set default options for parsing config\n    options.parsingConfig = extend({\n        highlightFormatting: true, // needed for toggleCodeBlock to detect types of code\n    }, options.parsingConfig || {});\n\n\n    // Merging the insertTexts, with the given options\n    options.insertTexts = extend({}, insertTexts, options.insertTexts || {});\n\n\n    // Merging the promptTexts, with the given options\n    options.promptTexts = extend({}, promptTexts, options.promptTexts || {});\n\n\n    // Merging the blockStyles, with the given options\n    options.blockStyles = extend({}, blockStyles, options.blockStyles || {});\n\n\n    if (options.autosave != undefined) {\n        // Merging the Autosave timeFormat, with the given options\n        options.autosave.timeFormat = extend({}, timeFormat, options.autosave.timeFormat || {});\n    }\n\n\n    // Merging the shortcuts, with the given options\n    options.shortcuts = extend({}, shortcuts, options.shortcuts || {});\n\n    options.maxHeight = options.maxHeight || undefined;\n\n    options.direction = options.direction || 'ltr';\n\n    if (typeof options.maxHeight !== 'undefined') {\n        // Min and max height are equal if maxHeight is set\n        options.minHeight = options.maxHeight;\n    } else {\n        options.minHeight = options.minHeight || '300px';\n    }\n\n    options.errorCallback = options.errorCallback || function (errorMessage) {\n        alert(errorMessage);\n    };\n\n    // Import-image default configuration\n    options.uploadImage = options.uploadImage || false;\n    options.imageMaxSize = options.imageMaxSize || 2097152; // 1024 * 1024 * 2\n    options.imageAccept = options.imageAccept || 'image/png, image/jpeg';\n    options.imageTexts = extend({}, imageTexts, options.imageTexts || {});\n    options.errorMessages = extend({}, errorMessages, options.errorMessages || {});\n\n\n    // Change unique_id to uniqueId for backwards compatibility\n    if (options.autosave != undefined && options.autosave.unique_id != undefined && options.autosave.unique_id != '')\n        options.autosave.uniqueId = options.autosave.unique_id;\n\n    // If overlay mode is specified and combine is not provided, default it to true\n    if (options.overlayMode && options.overlayMode.combine === undefined) {\n        options.overlayMode.combine = true;\n    }\n\n    // Update this options\n    this.options = options;\n\n\n    // Auto render\n    this.render();\n\n\n    // The codemirror component is only available after rendering\n    // so, the setter for the initialValue can only run after\n    // the element has been rendered\n    if (options.initialValue && (!this.options.autosave || this.options.autosave.foundSavedValue !== true)) {\n        this.value(options.initialValue);\n    }\n\n    if (options.uploadImage) {\n        var self = this;\n\n        this.codemirror.on('dragenter', function (cm, event) {\n            self.updateStatusBar('upload-image', self.options.imageTexts.sbOnDragEnter);\n            event.stopPropagation();\n            event.preventDefault();\n        });\n        this.codemirror.on('dragend', function (cm, event) {\n            self.updateStatusBar('upload-image', self.options.imageTexts.sbInit);\n            event.stopPropagation();\n            event.preventDefault();\n        });\n        this.codemirror.on('dragleave', function (cm, event) {\n            self.updateStatusBar('upload-image', self.options.imageTexts.sbInit);\n            event.stopPropagation();\n            event.preventDefault();\n        });\n\n        this.codemirror.on('dragover', function (cm, event) {\n            self.updateStatusBar('upload-image', self.options.imageTexts.sbOnDragEnter);\n            event.stopPropagation();\n            event.preventDefault();\n        });\n\n        this.codemirror.on('drop', function (cm, event) {\n            event.stopPropagation();\n            event.preventDefault();\n            if (options.imageUploadFunction) {\n                self.uploadImagesUsingCustomFunction(options.imageUploadFunction, event.dataTransfer.files);\n            } else {\n                self.uploadImages(event.dataTransfer.files);\n            }\n        });\n\n        this.codemirror.on('paste', function (cm, event) {\n            if (options.imageUploadFunction) {\n                self.uploadImagesUsingCustomFunction(options.imageUploadFunction, event.clipboardData.files);\n            } else {\n                self.uploadImages(event.clipboardData.files);\n            }\n        });\n    }\n}\n\n/**\n * Upload asynchronously a list of images to a server.\n *\n * Can be triggered by:\n * - drag&drop;\n * - copy-paste;\n * - the browse-file window (opened when the user clicks on the *upload-image* icon).\n * @param {FileList} files The files to upload the the server.\n * @param [onSuccess] {function} see EasyMDE.prototype.uploadImage\n * @param [onError] {function} see EasyMDE.prototype.uploadImage\n */\nEasyMDE.prototype.uploadImages = function (files, onSuccess, onError) {\n    if (files.length === 0) {\n        return;\n    }\n    var names = [];\n    for (var i = 0; i < files.length; i++) {\n        names.push(files[i].name);\n        this.uploadImage(files[i], onSuccess, onError);\n    }\n    this.updateStatusBar('upload-image', this.options.imageTexts.sbOnDrop.replace('#images_names#', names.join(', ')));\n};\n\n/**\n * Upload asynchronously a list of images to a server.\n *\n * Can be triggered by:\n * - drag&drop;\n * - copy-paste;\n * - the browse-file window (opened when the user clicks on the *upload-image* icon).\n * @param imageUploadFunction {Function} The custom function to upload the image passed in options.\n * @param {FileList} files The files to upload the the server.\n */\nEasyMDE.prototype.uploadImagesUsingCustomFunction = function (imageUploadFunction, files) {\n    if (files.length === 0) {\n        return;\n    }\n    var names = [];\n    for (var i = 0; i < files.length; i++) {\n        names.push(files[i].name);\n        this.uploadImageUsingCustomFunction(imageUploadFunction, files[i]);\n    }\n    this.updateStatusBar('upload-image', this.options.imageTexts.sbOnDrop.replace('#images_names#', names.join(', ')));\n};\n\n/**\n * Update an item in the status bar.\n * @param itemName {string} The name of the item to update (ie. 'upload-image', 'autosave', etc.).\n * @param content {string} the new content of the item to write in the status bar.\n */\nEasyMDE.prototype.updateStatusBar = function (itemName, content) {\n    if (!this.gui.statusbar) {\n        return;\n    }\n\n    var matchingClasses = this.gui.statusbar.getElementsByClassName(itemName);\n    if (matchingClasses.length === 1) {\n        this.gui.statusbar.getElementsByClassName(itemName)[0].textContent = content;\n    } else if (matchingClasses.length === 0) {\n        console.log('EasyMDE: status bar item ' + itemName + ' was not found.');\n    } else {\n        console.log('EasyMDE: Several status bar items named ' + itemName + ' was found.');\n    }\n};\n\n/**\n * Default markdown render.\n */\nEasyMDE.prototype.markdown = function (text) {\n    if (marked) {\n        // Initialize\n        var markedOptions;\n        if (this.options && this.options.renderingConfig && this.options.renderingConfig.markedOptions) {\n            markedOptions = this.options.renderingConfig.markedOptions;\n        } else {\n            markedOptions = {};\n        }\n\n        // Update options\n        if (this.options && this.options.renderingConfig && this.options.renderingConfig.singleLineBreaks === false) {\n            markedOptions.breaks = false;\n        } else {\n            markedOptions.breaks = true;\n        }\n\n        if (this.options && this.options.renderingConfig && this.options.renderingConfig.codeSyntaxHighlighting === true) {\n\n            /* Get HLJS from config or window */\n            var hljs = this.options.renderingConfig.hljs || window.hljs;\n\n            /* Check if HLJS loaded */\n            if (hljs) {\n                markedOptions.highlight = function (code, language) {\n                    if (language && hljs.getLanguage(language)) {\n                        return hljs.highlight(language, code).value;\n                    } else {\n                        return hljs.highlightAuto(code).value;\n                    }\n                };\n            }\n        }\n\n        // Set options\n        marked.setOptions(markedOptions);\n\n        // Convert the markdown to HTML\n        var htmlText = marked.parse(text);\n\n        // Sanitize HTML\n        if (this.options.renderingConfig && typeof this.options.renderingConfig.sanitizerFunction === 'function') {\n            htmlText = this.options.renderingConfig.sanitizerFunction.call(this, htmlText);\n        }\n\n        // Edit the HTML anchors to add 'target=\"_blank\"' by default.\n        htmlText = addAnchorTargetBlank(htmlText);\n\n        // Remove list-style when rendering checkboxes\n        htmlText = removeListStyleWhenCheckbox(htmlText);\n\n        return htmlText;\n    }\n};\n\n/**\n * Render editor to the given element.\n */\nEasyMDE.prototype.render = function (el) {\n    if (!el) {\n        el = this.element || document.getElementsByTagName('textarea')[0];\n    }\n\n    if (this._rendered && this._rendered === el) {\n        // Already rendered.\n        return;\n    }\n\n    this.element = el;\n    var options = this.options;\n\n    var self = this;\n    var keyMaps = {};\n\n    for (var key in options.shortcuts) {\n        // null stands for \"do not bind this command\"\n        if (options.shortcuts[key] !== null && bindings[key] !== null) {\n            (function (key) {\n                keyMaps[fixShortcut(options.shortcuts[key])] = function () {\n                    var action = bindings[key];\n                    if (typeof action === 'function') {\n                        action(self);\n                    } else if (typeof action === 'string') {\n                        window.open(action, '_blank');\n                    }\n                };\n            })(key);\n        }\n    }\n\n    keyMaps['Enter'] = 'newlineAndIndentContinueMarkdownList';\n    keyMaps['Tab'] = 'tabAndIndentMarkdownList';\n    keyMaps['Shift-Tab'] = 'shiftTabAndUnindentMarkdownList';\n    keyMaps['Esc'] = function (cm) {\n        if (cm.getOption('fullScreen')) toggleFullScreen(self);\n    };\n\n    this.documentOnKeyDown = function (e) {\n        e = e || window.event;\n\n        if (e.keyCode == 27) {\n            if (self.codemirror.getOption('fullScreen')) toggleFullScreen(self);\n        }\n    };\n    document.addEventListener('keydown', this.documentOnKeyDown, false);\n\n    var mode, backdrop;\n\n    // CodeMirror overlay mode\n    if (options.overlayMode) {\n        CodeMirror.defineMode('overlay-mode', function (config) {\n            return CodeMirror.overlayMode(CodeMirror.getMode(config, options.spellChecker !== false ? 'spell-checker' : 'gfm'), options.overlayMode.mode, options.overlayMode.combine);\n        });\n\n        mode = 'overlay-mode';\n        backdrop = options.parsingConfig;\n        backdrop.gitHubSpice = false;\n    } else {\n        mode = options.parsingConfig;\n        mode.name = 'gfm';\n        mode.gitHubSpice = false;\n    }\n    if (options.spellChecker !== false) {\n        mode = 'spell-checker';\n        backdrop = options.parsingConfig;\n        backdrop.name = 'gfm';\n        backdrop.gitHubSpice = false;\n\n        if (typeof options.spellChecker === 'function') {\n            options.spellChecker({\n                codeMirrorInstance: CodeMirror,\n            });\n        } else {\n            CodeMirrorSpellChecker({\n                codeMirrorInstance: CodeMirror,\n            });\n        }\n    }\n\n    // eslint-disable-next-line no-unused-vars\n    function configureMouse(cm, repeat, event) {\n        return {\n            addNew: false,\n        };\n    }\n\n    this.codemirror = CodeMirror.fromTextArea(el, {\n        mode: mode,\n        backdrop: backdrop,\n        theme: (options.theme != undefined) ? options.theme : 'easymde',\n        tabSize: (options.tabSize != undefined) ? options.tabSize : 2,\n        indentUnit: (options.tabSize != undefined) ? options.tabSize : 2,\n        indentWithTabs: (options.indentWithTabs === false) ? false : true,\n        lineNumbers: (options.lineNumbers === true) ? true : false,\n        autofocus: (options.autofocus === true) ? true : false,\n        extraKeys: keyMaps,\n        direction: options.direction,\n        lineWrapping: (options.lineWrapping === false) ? false : true,\n        allowDropFileTypes: ['text/plain'],\n        placeholder: options.placeholder || el.getAttribute('placeholder') || '',\n        styleSelectedText: (options.styleSelectedText != undefined) ? options.styleSelectedText : !isMobile(),\n        scrollbarStyle: (options.scrollbarStyle != undefined) ? options.scrollbarStyle : 'native',\n        configureMouse: configureMouse,\n        inputStyle: (options.inputStyle != undefined) ? options.inputStyle : isMobile() ? 'contenteditable' : 'textarea',\n        spellcheck: (options.nativeSpellcheck != undefined) ? options.nativeSpellcheck : true,\n        autoRefresh: (options.autoRefresh != undefined) ? options.autoRefresh : false,\n    });\n\n    this.codemirror.getScrollerElement().style.minHeight = options.minHeight;\n\n    if (typeof options.maxHeight !== 'undefined') {\n        this.codemirror.getScrollerElement().style.height = options.maxHeight;\n    }\n\n    if (options.forceSync === true) {\n        var cm = this.codemirror;\n        cm.on('change', function () {\n            cm.save();\n        });\n    }\n\n    this.gui = {};\n\n    // Wrap Codemirror with container before create toolbar, etc,\n    // to use with sideBySideFullscreen option.\n    var easyMDEContainer = document.createElement('div');\n    easyMDEContainer.classList.add('EasyMDEContainer');\n    var cmWrapper = this.codemirror.getWrapperElement();\n    cmWrapper.parentNode.insertBefore(easyMDEContainer, cmWrapper);\n    easyMDEContainer.appendChild(cmWrapper);\n\n    if (options.toolbar !== false) {\n        this.gui.toolbar = this.createToolbar();\n    }\n    if (options.status !== false) {\n        this.gui.statusbar = this.createStatusbar();\n    }\n    if (options.autosave != undefined && options.autosave.enabled === true) {\n        this.autosave(); // use to load localstorage content\n        this.codemirror.on('change', function () {\n            clearTimeout(self._autosave_timeout);\n            self._autosave_timeout = setTimeout(function () {\n                self.autosave();\n            }, self.options.autosave.submit_delay || self.options.autosave.delay || 1000);\n        });\n    }\n\n    function calcHeight(naturalWidth, naturalHeight) {\n        var height;\n        var viewportWidth = window.getComputedStyle(document.querySelector('.CodeMirror-sizer')).width.replace('px', '');\n        if (naturalWidth < viewportWidth) {\n            height = naturalHeight + 'px';\n        } else {\n            height = (naturalHeight / naturalWidth * 100) + '%';\n        }\n        return height;\n    }\n\n    var _vm = this;\n\n\n    function assignImageBlockAttributes(parentEl, img) {\n        parentEl.setAttribute('data-img-src', img.url);\n        parentEl.setAttribute('style', '--bg-image:url(' + img.url + ');--width:' + img.naturalWidth + 'px;--height:' + calcHeight(img.naturalWidth, img.naturalHeight));\n        _vm.codemirror.setSize();\n    }\n\n    function handleImages() {\n        if (!options.previewImagesInEditor) {\n            return;\n        }\n\n        easyMDEContainer.querySelectorAll('.cm-image-marker').forEach(function (e) {\n            var parentEl = e.parentElement;\n            if (!parentEl.innerText.match(/^!\\[.*?\\]\\(.*\\)/g)) {\n                // if img pasted on the same line with other text, don't preview, preview only images on separate line\n                return;\n            }\n            if (!parentEl.hasAttribute('data-img-src')) {\n                var srcAttr = parentEl.innerText.match('\\\\((.*)\\\\)'); // might require better parsing according to markdown spec\n                if (!window.EMDEimagesCache) {\n                    window.EMDEimagesCache = {};\n                }\n\n                if (srcAttr && srcAttr.length >= 2) {\n                    var keySrc = srcAttr[1];\n\n                    if (!window.EMDEimagesCache[keySrc]) {\n                        var img = document.createElement('img');\n                        img.onload = function () {\n                            window.EMDEimagesCache[keySrc] = {\n                                naturalWidth: img.naturalWidth,\n                                naturalHeight: img.naturalHeight,\n                                url: keySrc,\n                            };\n                            assignImageBlockAttributes(parentEl, window.EMDEimagesCache[keySrc]);\n                        };\n                        img.src = keySrc;\n                    } else {\n                        assignImageBlockAttributes(parentEl, window.EMDEimagesCache[keySrc]);\n                    }\n                }\n            }\n        });\n    }\n\n    this.codemirror.on('update', function () {\n        handleImages();\n    });\n\n    this.gui.sideBySide = this.createSideBySide();\n    this._rendered = this.element;\n\n    // Fixes CodeMirror bug (#344)\n    var temp_cm = this.codemirror;\n    setTimeout(function () {\n        temp_cm.refresh();\n    }.bind(temp_cm), 0);\n};\n\nEasyMDE.prototype.cleanup = function () {\n    document.removeEventListener('keydown', this.documentOnKeyDown);\n};\n\n// Safari, in Private Browsing Mode, looks like it supports localStorage but all calls to setItem throw QuotaExceededError. We're going to detect this and set a variable accordingly.\nfunction isLocalStorageAvailable() {\n    if (typeof localStorage === 'object') {\n        try {\n            localStorage.setItem('smde_localStorage', 1);\n            localStorage.removeItem('smde_localStorage');\n        } catch (e) {\n            return false;\n        }\n    } else {\n        return false;\n    }\n\n    return true;\n}\n\nEasyMDE.prototype.autosave = function () {\n    if (isLocalStorageAvailable()) {\n        var easyMDE = this;\n\n        if (this.options.autosave.uniqueId == undefined || this.options.autosave.uniqueId == '') {\n            console.log('EasyMDE: You must set a uniqueId to use the autosave feature');\n            return;\n        }\n\n        if (this.options.autosave.binded !== true) {\n            if (easyMDE.element.form != null && easyMDE.element.form != undefined) {\n                easyMDE.element.form.addEventListener('submit', function () {\n                    clearTimeout(easyMDE.autosaveTimeoutId);\n                    easyMDE.autosaveTimeoutId = undefined;\n\n                    localStorage.removeItem('smde_' + easyMDE.options.autosave.uniqueId);\n                });\n            }\n\n            this.options.autosave.binded = true;\n        }\n\n        if (this.options.autosave.loaded !== true) {\n            if (typeof localStorage.getItem('smde_' + this.options.autosave.uniqueId) == 'string' && localStorage.getItem('smde_' + this.options.autosave.uniqueId) != '') {\n                this.codemirror.setValue(localStorage.getItem('smde_' + this.options.autosave.uniqueId));\n                this.options.autosave.foundSavedValue = true;\n            }\n\n            this.options.autosave.loaded = true;\n        }\n\n        var value = easyMDE.value();\n        if (value !== '') {\n            localStorage.setItem('smde_' + this.options.autosave.uniqueId, value);\n        } else {\n            localStorage.removeItem('smde_' + this.options.autosave.uniqueId);\n        }\n\n        var el = document.getElementById('autosaved');\n        if (el != null && el != undefined && el != '') {\n            var d = new Date();\n            var dd = new Intl.DateTimeFormat([this.options.autosave.timeFormat.locale, 'en-US'], this.options.autosave.timeFormat.format).format(d);\n            var save = this.options.autosave.text == undefined ? 'Autosaved: ' : this.options.autosave.text;\n\n            el.innerHTML = save + dd;\n        }\n    } else {\n        console.log('EasyMDE: localStorage not available, cannot autosave');\n    }\n};\n\nEasyMDE.prototype.clearAutosavedValue = function () {\n    if (isLocalStorageAvailable()) {\n        if (this.options.autosave == undefined || this.options.autosave.uniqueId == undefined || this.options.autosave.uniqueId == '') {\n            console.log('EasyMDE: You must set a uniqueId to clear the autosave value');\n            return;\n        }\n\n        localStorage.removeItem('smde_' + this.options.autosave.uniqueId);\n    } else {\n        console.log('EasyMDE: localStorage not available, cannot autosave');\n    }\n};\n\n/**\n * Open the browse-file window to upload an image to a server.\n * @param [onSuccess] {function} see EasyMDE.prototype.uploadImage\n * @param [onError] {function} see EasyMDE.prototype.uploadImage\n */\nEasyMDE.prototype.openBrowseFileWindow = function (onSuccess, onError) {\n    var self = this;\n    var imageInput = this.gui.toolbar.getElementsByClassName('imageInput')[0];\n    imageInput.click(); //dispatchEvent(new MouseEvent('click'));  // replaced with click() for IE11 compatibility.\n    function onChange(event) {\n        if (self.options.imageUploadFunction) {\n            self.uploadImagesUsingCustomFunction(self.options.imageUploadFunction, event.target.files);\n        } else {\n            self.uploadImages(event.target.files, onSuccess, onError);\n        }\n        imageInput.removeEventListener('change', onChange);\n    }\n\n    imageInput.addEventListener('change', onChange);\n};\n\n/**\n * Upload an image to the server.\n *\n * @param file {File} The image to upload, as a HTML5 File object (https://developer.mozilla.org/en-US/docs/Web/API/File)\n * @param [onSuccess] {function} A callback function to execute after the image has been successfully uploaded, with one parameter:\n * - url (string): The URL of the uploaded image.\n * @param [onError] {function} A callback function to execute when the image upload fails, with one parameter:\n * - error (string): the detailed error to display to the user (based on messages from options.errorMessages).\n */\nEasyMDE.prototype.uploadImage = function (file, onSuccess, onError) {\n    var self = this;\n    onSuccess = onSuccess || function onSuccess(imageUrl) {\n        afterImageUploaded(self, imageUrl);\n    };\n\n    function onErrorSup(errorMessage) {\n        // show error on status bar and reset after 10000ms\n        self.updateStatusBar('upload-image', errorMessage);\n\n        setTimeout(function () {\n            self.updateStatusBar('upload-image', self.options.imageTexts.sbInit);\n        }, 10000);\n\n        // run custom error handler\n        if (onError && typeof onError === 'function') {\n            onError(errorMessage);\n        }\n        // run error handler from options, this alerts the message.\n        self.options.errorCallback(errorMessage);\n    }\n\n    function fillErrorMessage(errorMessage) {\n        var units = self.options.imageTexts.sizeUnits.split(',');\n        return errorMessage\n            .replace('#image_name#', file.name)\n            .replace('#image_size#', humanFileSize(file.size, units))\n            .replace('#image_max_size#', humanFileSize(self.options.imageMaxSize, units));\n    }\n\n    if (file.size > this.options.imageMaxSize) {\n        onErrorSup(fillErrorMessage(this.options.errorMessages.fileTooLarge));\n        return;\n    }\n\n    var formData = new FormData();\n    formData.append('image', file);\n\n    // insert CSRF token if provided in config.\n    if (self.options.imageCSRFToken) {\n        formData.append('csrfmiddlewaretoken', self.options.imageCSRFToken);\n    }\n    var request = new XMLHttpRequest();\n    request.upload.onprogress = function (event) {\n        if (event.lengthComputable) {\n            var progress = '' + Math.round((event.loaded * 100) / event.total);\n            self.updateStatusBar('upload-image', self.options.imageTexts.sbProgress.replace('#file_name#', file.name).replace('#progress#', progress));\n        }\n    };\n    request.open('POST', this.options.imageUploadEndpoint);\n\n    request.onload = function () {\n        try {\n            var response = JSON.parse(this.responseText);\n        } catch (error) {\n            console.error('EasyMDE: The server did not return a valid json.');\n            onErrorSup(fillErrorMessage(self.options.errorMessages.importError));\n            return;\n        }\n        if (this.status === 200 && response && !response.error && response.data && response.data.filePath) {\n            onSuccess((self.options.imagePathAbsolute ? '' : (window.location.origin + '/')) + response.data.filePath);\n        } else {\n            if (response.error && response.error in self.options.errorMessages) {  // preformatted error message\n                onErrorSup(fillErrorMessage(self.options.errorMessages[response.error]));\n            } else if (response.error) {  // server side generated error message\n                onErrorSup(fillErrorMessage(response.error));\n            } else {  //unknown error\n                console.error('EasyMDE: Received an unexpected response after uploading the image.'\n                    + this.status + ' (' + this.statusText + ')');\n                onErrorSup(fillErrorMessage(self.options.errorMessages.importError));\n            }\n        }\n    };\n\n    request.onerror = function (event) {\n        console.error('EasyMDE: An unexpected error occurred when trying to upload the image.'\n            + event.target.status + ' (' + event.target.statusText + ')');\n        onErrorSup(self.options.errorMessages.importError);\n    };\n\n    request.send(formData);\n\n};\n\n/**\n * Upload an image to the server using a custom upload function.\n *\n * @param imageUploadFunction {Function} The custom function to upload the image passed in options\n * @param file {File} The image to upload, as a HTML5 File object (https://developer.mozilla.org/en-US/docs/Web/API/File).\n */\nEasyMDE.prototype.uploadImageUsingCustomFunction = function (imageUploadFunction, file) {\n    var self = this;\n\n    function onSuccess(imageUrl) {\n        afterImageUploaded(self, imageUrl);\n    }\n\n    function onError(errorMessage) {\n        var filledErrorMessage = fillErrorMessage(errorMessage);\n        // show error on status bar and reset after 10000ms\n        self.updateStatusBar('upload-image', filledErrorMessage);\n\n        setTimeout(function () {\n            self.updateStatusBar('upload-image', self.options.imageTexts.sbInit);\n        }, 10000);\n\n        // run error handler from options, this alerts the message.\n        self.options.errorCallback(filledErrorMessage);\n    }\n\n    function fillErrorMessage(errorMessage) {\n        var units = self.options.imageTexts.sizeUnits.split(',');\n        return errorMessage\n            .replace('#image_name#', file.name)\n            .replace('#image_size#', humanFileSize(file.size, units))\n            .replace('#image_max_size#', humanFileSize(self.options.imageMaxSize, units));\n    }\n\n    imageUploadFunction.apply(this, [file, onSuccess, onError]);\n};\n\nEasyMDE.prototype.setPreviewMaxHeight = function () {\n    var cm = this.codemirror;\n    var wrapper = cm.getWrapperElement();\n    var preview = wrapper.nextSibling;\n\n    // Calc preview max height\n    var paddingTop = parseInt(window.getComputedStyle(wrapper).paddingTop);\n    var borderTopWidth = parseInt(window.getComputedStyle(wrapper).borderTopWidth);\n    var optionsMaxHeight = parseInt(this.options.maxHeight);\n    var wrapperMaxHeight = optionsMaxHeight + paddingTop * 2 + borderTopWidth * 2;\n    var previewMaxHeight = wrapperMaxHeight.toString() + 'px';\n\n    preview.style.height = previewMaxHeight;\n};\n\nEasyMDE.prototype.createSideBySide = function () {\n    var cm = this.codemirror;\n    var wrapper = cm.getWrapperElement();\n    var preview = wrapper.nextSibling;\n\n    if (!preview || !/editor-preview-side/.test(preview.className)) {\n        preview = document.createElement('div');\n        preview.className = 'editor-preview-side';\n\n        if (this.options.previewClass) {\n\n            if (Array.isArray(this.options.previewClass)) {\n                for (var i = 0; i < this.options.previewClass.length; i++) {\n                    preview.className += (' ' + this.options.previewClass[i]);\n                }\n\n            } else if (typeof this.options.previewClass === 'string') {\n                preview.className += (' ' + this.options.previewClass);\n            }\n        }\n\n        wrapper.parentNode.insertBefore(preview, wrapper.nextSibling);\n    }\n\n    if (typeof this.options.maxHeight !== 'undefined') {\n        this.setPreviewMaxHeight();\n    }\n\n    if (this.options.syncSideBySidePreviewScroll === false) return preview;\n    // Syncs scroll  editor -> preview\n    var cScroll = false;\n    var pScroll = false;\n    cm.on('scroll', function (v) {\n        if (cScroll) {\n            cScroll = false;\n            return;\n        }\n        pScroll = true;\n        var height = v.getScrollInfo().height - v.getScrollInfo().clientHeight;\n        var ratio = parseFloat(v.getScrollInfo().top) / height;\n        var move = (preview.scrollHeight - preview.clientHeight) * ratio;\n        preview.scrollTop = move;\n    });\n\n    // Syncs scroll  preview -> editor\n    preview.onscroll = function () {\n        if (pScroll) {\n            pScroll = false;\n            return;\n        }\n        cScroll = true;\n        var height = preview.scrollHeight - preview.clientHeight;\n        var ratio = parseFloat(preview.scrollTop) / height;\n        var move = (cm.getScrollInfo().height - cm.getScrollInfo().clientHeight) * ratio;\n        cm.scrollTo(0, move);\n    };\n    return preview;\n};\n\nEasyMDE.prototype.createToolbar = function (items) {\n    items = items || this.options.toolbar;\n\n    if (!items || items.length === 0) {\n        return;\n    }\n    var i;\n    for (i = 0; i < items.length; i++) {\n        if (toolbarBuiltInButtons[items[i]] != undefined) {\n            items[i] = toolbarBuiltInButtons[items[i]];\n        }\n    }\n\n    var bar = document.createElement('div');\n    bar.className = 'editor-toolbar';\n\n    var self = this;\n\n    var toolbarData = {};\n    self.toolbar = items;\n\n    for (i = 0; i < items.length; i++) {\n        if (items[i].name == 'guide' && self.options.toolbarGuideIcon === false)\n            continue;\n\n        if (self.options.hideIcons && self.options.hideIcons.indexOf(items[i].name) != -1)\n            continue;\n\n        // Fullscreen does not work well on mobile devices (even tablets)\n        // In the future, hopefully this can be resolved\n        if ((items[i].name == 'fullscreen' || items[i].name == 'side-by-side') && isMobile())\n            continue;\n\n\n        // Don't include trailing separators\n        if (items[i] === '|') {\n            var nonSeparatorIconsFollow = false;\n\n            for (var x = (i + 1); x < items.length; x++) {\n                if (items[x] !== '|' && (!self.options.hideIcons || self.options.hideIcons.indexOf(items[x].name) == -1)) {\n                    nonSeparatorIconsFollow = true;\n                }\n            }\n\n            if (!nonSeparatorIconsFollow)\n                continue;\n        }\n\n\n        // Create the icon and append to the toolbar\n        (function (item) {\n            var el;\n            if (item === '|') {\n                el = createSep();\n            } else if (item.children) {\n                el = createToolbarDropdown(item, self.options.toolbarTips, self.options.shortcuts, self);\n            } else {\n                el = createToolbarButton(item, true, self.options.toolbarTips, self.options.shortcuts, 'button', self);\n            }\n\n\n            toolbarData[item.name || item] = el;\n            bar.appendChild(el);\n\n            // Create the input element (ie. <input type='file'>), used among\n            // with the 'import-image' icon to open the browse-file window.\n            if (item.name === 'upload-image') {\n                var imageInput = document.createElement('input');\n                imageInput.className = 'imageInput';\n                imageInput.type = 'file';\n                imageInput.multiple = true;\n                imageInput.name = 'image';\n                imageInput.accept = self.options.imageAccept;\n                imageInput.style.display = 'none';\n                imageInput.style.opacity = 0;\n                bar.appendChild(imageInput);\n            }\n        })(items[i]);\n    }\n\n    self.toolbar_div = bar;\n    self.toolbarElements = toolbarData;\n\n    var cm = this.codemirror;\n    cm.on('cursorActivity', function () {\n        var stat = getState(cm);\n\n        for (var key in toolbarData) {\n            (function (key) {\n                var el = toolbarData[key];\n                if (stat[key]) {\n                    el.className += ' active';\n                } else if (key != 'fullscreen' && key != 'side-by-side') {\n                    el.className = el.className.replace(/\\s*active\\s*/g, '');\n                }\n            })(key);\n        }\n    });\n\n    var cmWrapper = cm.getWrapperElement();\n    cmWrapper.parentNode.insertBefore(bar, cmWrapper);\n    return bar;\n};\n\nEasyMDE.prototype.createStatusbar = function (status) {\n    // Initialize\n    status = status || this.options.status;\n    var options = this.options;\n    var cm = this.codemirror;\n\n    // Make sure the status variable is valid\n    if (!status || status.length === 0) {\n        return;\n    }\n\n    // Set up the built-in items\n    var items = [];\n    var i, onUpdate, onActivity, defaultValue;\n\n    for (i = 0; i < status.length; i++) {\n        // Reset some values\n        onUpdate = undefined;\n        onActivity = undefined;\n        defaultValue = undefined;\n\n\n        // Handle if custom or not\n        if (typeof status[i] === 'object') {\n            items.push({\n                className: status[i].className,\n                defaultValue: status[i].defaultValue,\n                onUpdate: status[i].onUpdate,\n                onActivity: status[i].onActivity,\n            });\n        } else {\n            var name = status[i];\n\n            if (name === 'words') {\n                defaultValue = function (el) {\n                    el.innerHTML = wordCount(cm.getValue());\n                };\n                onUpdate = function (el) {\n                    el.innerHTML = wordCount(cm.getValue());\n                };\n            } else if (name === 'lines') {\n                defaultValue = function (el) {\n                    el.innerHTML = cm.lineCount();\n                };\n                onUpdate = function (el) {\n                    el.innerHTML = cm.lineCount();\n                };\n            } else if (name === 'cursor') {\n                defaultValue = function (el) {\n                    el.innerHTML = '1:1';\n                };\n                onActivity = function (el) {\n                    var pos = cm.getCursor();\n                    var posLine = pos.line + 1;\n                    var posColumn = pos.ch + 1;\n                    el.innerHTML = posLine + ':' + posColumn;\n                };\n            } else if (name === 'autosave') {\n                defaultValue = function (el) {\n                    if (options.autosave != undefined && options.autosave.enabled === true) {\n                        el.setAttribute('id', 'autosaved');\n                    }\n                };\n            } else if (name === 'upload-image') {\n                defaultValue = function (el) {\n                    el.innerHTML = options.imageTexts.sbInit;\n                };\n            }\n\n            items.push({\n                className: name,\n                defaultValue: defaultValue,\n                onUpdate: onUpdate,\n                onActivity: onActivity,\n            });\n        }\n    }\n\n\n    // Create element for the status bar\n    var bar = document.createElement('div');\n    bar.className = 'editor-statusbar';\n\n\n    // Create a new span for each item\n    for (i = 0; i < items.length; i++) {\n        // Store in temporary variable\n        var item = items[i];\n\n\n        // Create span element\n        var el = document.createElement('span');\n        el.className = item.className;\n\n\n        // Ensure the defaultValue is a function\n        if (typeof item.defaultValue === 'function') {\n            item.defaultValue(el);\n        }\n\n\n        // Ensure the onUpdate is a function\n        if (typeof item.onUpdate === 'function') {\n            // Create a closure around the span of the current action, then execute the onUpdate handler\n            this.codemirror.on('update', (function (el, item) {\n                return function () {\n                    item.onUpdate(el);\n                };\n            }(el, item)));\n        }\n        if (typeof item.onActivity === 'function') {\n            // Create a closure around the span of the current action, then execute the onActivity handler\n            this.codemirror.on('cursorActivity', (function (el, item) {\n                return function () {\n                    item.onActivity(el);\n                };\n            }(el, item)));\n        }\n\n\n        // Append the item to the status bar\n        bar.appendChild(el);\n    }\n\n\n    // Insert the status bar into the DOM\n    var cmWrapper = this.codemirror.getWrapperElement();\n    cmWrapper.parentNode.insertBefore(bar, cmWrapper.nextSibling);\n    return bar;\n};\n\n/**\n * Get or set the text content.\n */\nEasyMDE.prototype.value = function (val) {\n    var cm = this.codemirror;\n    if (val === undefined) {\n        return cm.getValue();\n    } else {\n        cm.getDoc().setValue(val);\n        if (this.isPreviewActive()) {\n            var wrapper = cm.getWrapperElement();\n            var preview = wrapper.lastChild;\n            preview.innerHTML = this.options.previewRender(val, preview);\n        }\n        return this;\n    }\n};\n\n\n/**\n * Bind static methods for exports.\n */\nEasyMDE.toggleBold = toggleBold;\nEasyMDE.toggleItalic = toggleItalic;\nEasyMDE.toggleStrikethrough = toggleStrikethrough;\nEasyMDE.toggleBlockquote = toggleBlockquote;\nEasyMDE.toggleHeadingSmaller = toggleHeadingSmaller;\nEasyMDE.toggleHeadingBigger = toggleHeadingBigger;\nEasyMDE.toggleHeading1 = toggleHeading1;\nEasyMDE.toggleHeading2 = toggleHeading2;\nEasyMDE.toggleHeading3 = toggleHeading3;\nEasyMDE.toggleCodeBlock = toggleCodeBlock;\nEasyMDE.toggleUnorderedList = toggleUnorderedList;\nEasyMDE.toggleOrderedList = toggleOrderedList;\nEasyMDE.cleanBlock = cleanBlock;\nEasyMDE.drawLink = drawLink;\nEasyMDE.drawImage = drawImage;\nEasyMDE.drawUploadedImage = drawUploadedImage;\nEasyMDE.drawTable = drawTable;\nEasyMDE.drawHorizontalRule = drawHorizontalRule;\nEasyMDE.undo = undo;\nEasyMDE.redo = redo;\nEasyMDE.togglePreview = togglePreview;\nEasyMDE.toggleSideBySide = toggleSideBySide;\nEasyMDE.toggleFullScreen = toggleFullScreen;\n\n/**\n * Bind instance methods for exports.\n */\nEasyMDE.prototype.toggleBold = function () {\n    toggleBold(this);\n};\nEasyMDE.prototype.toggleItalic = function () {\n    toggleItalic(this);\n};\nEasyMDE.prototype.toggleStrikethrough = function () {\n    toggleStrikethrough(this);\n};\nEasyMDE.prototype.toggleBlockquote = function () {\n    toggleBlockquote(this);\n};\nEasyMDE.prototype.toggleHeadingSmaller = function () {\n    toggleHeadingSmaller(this);\n};\nEasyMDE.prototype.toggleHeadingBigger = function () {\n    toggleHeadingBigger(this);\n};\nEasyMDE.prototype.toggleHeading1 = function () {\n    toggleHeading1(this);\n};\nEasyMDE.prototype.toggleHeading2 = function () {\n    toggleHeading2(this);\n};\nEasyMDE.prototype.toggleHeading3 = function () {\n    toggleHeading3(this);\n};\nEasyMDE.prototype.toggleCodeBlock = function () {\n    toggleCodeBlock(this);\n};\nEasyMDE.prototype.toggleUnorderedList = function () {\n    toggleUnorderedList(this);\n};\nEasyMDE.prototype.toggleOrderedList = function () {\n    toggleOrderedList(this);\n};\nEasyMDE.prototype.cleanBlock = function () {\n    cleanBlock(this);\n};\nEasyMDE.prototype.drawLink = function () {\n    drawLink(this);\n};\nEasyMDE.prototype.drawImage = function () {\n    drawImage(this);\n};\nEasyMDE.prototype.drawUploadedImage = function () {\n    drawUploadedImage(this);\n};\nEasyMDE.prototype.drawTable = function () {\n    drawTable(this);\n};\nEasyMDE.prototype.drawHorizontalRule = function () {\n    drawHorizontalRule(this);\n};\nEasyMDE.prototype.undo = function () {\n    undo(this);\n};\nEasyMDE.prototype.redo = function () {\n    redo(this);\n};\nEasyMDE.prototype.togglePreview = function () {\n    togglePreview(this);\n};\nEasyMDE.prototype.toggleSideBySide = function () {\n    toggleSideBySide(this);\n};\nEasyMDE.prototype.toggleFullScreen = function () {\n    toggleFullScreen(this);\n};\n\nEasyMDE.prototype.isPreviewActive = function () {\n    var cm = this.codemirror;\n    var wrapper = cm.getWrapperElement();\n    var preview = wrapper.lastChild;\n\n    return /editor-preview-active/.test(preview.className);\n};\n\nEasyMDE.prototype.isSideBySideActive = function () {\n    var cm = this.codemirror;\n    var wrapper = cm.getWrapperElement();\n    var preview = wrapper.nextSibling;\n\n    return /editor-preview-active-side/.test(preview.className);\n};\n\nEasyMDE.prototype.isFullscreenActive = function () {\n    var cm = this.codemirror;\n\n    return cm.getOption('fullScreen');\n};\n\nEasyMDE.prototype.getState = function () {\n    var cm = this.codemirror;\n\n    return getState(cm);\n};\n\nEasyMDE.prototype.toTextArea = function () {\n    var cm = this.codemirror;\n    var wrapper = cm.getWrapperElement();\n    var easyMDEContainer = wrapper.parentNode;\n\n    if (easyMDEContainer) {\n        if (this.gui.toolbar) {\n            easyMDEContainer.removeChild(this.gui.toolbar);\n        }\n        if (this.gui.statusbar) {\n            easyMDEContainer.removeChild(this.gui.statusbar);\n        }\n        if (this.gui.sideBySide) {\n            easyMDEContainer.removeChild(this.gui.sideBySide);\n        }\n    }\n\n    // Unwrap easyMDEcontainer before codemirror toTextArea() call\n    easyMDEContainer.parentNode.insertBefore(wrapper, easyMDEContainer);\n    easyMDEContainer.remove();\n\n    cm.toTextArea();\n\n    if (this.autosaveTimeoutId) {\n        clearTimeout(this.autosaveTimeoutId);\n        this.autosaveTimeoutId = undefined;\n        this.clearAutosavedValue();\n    }\n};\n\nmodule.exports = EasyMDE;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}